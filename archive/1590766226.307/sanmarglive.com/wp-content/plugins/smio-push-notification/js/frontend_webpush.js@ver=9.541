 "use strict"; var smpush_isPushEnabled = false; let firebaseInitialized = false; var devicetype = smpush_browser(); var settings = JSON.parse('{"chrome":1,"firefox":1,"opera":1,"edge":1,"samsung":1,"safari":0}'); smpush_debug(devicetype); function smpush_debug(error, object) { if(1 == 1){ if(typeof object !== "undefined"){ console.log(error, object); } else { console.log(error); } } } function smpush_endpoint_subscribe(subscriptionId, oldToken) { if(subscriptionId == ""){ return false; } smpush_setCookie("smpush_desktop_request", "true", 365); smpush_setCookie("smpush_device_token", subscriptionId, 60); var data = {}; data["device_token"] = subscriptionId; data["device_type"] = devicetype; data["firebase"] = 1; data["active"] = 1; data["latitude"] = (smpush_getCookie("smart_push_smio_coords_latitude") != "")? smpush_getCookie("smart_push_smio_coords_latitude") : ""; data["longitude"] = (smpush_getCookie("smart_push_smio_coords_longitude") != "")? smpush_getCookie("smart_push_smio_coords_longitude") : ""; var subsChannels = []; jQuery("input.smpush_desktop_channels_subs:checked").each(function(index) { subsChannels.push(jQuery(this).val()); }); subsChannels = subsChannels.join(","); if(jQuery(".smpush-push-subscriptions-button").length > 0 && jQuery("#smpush_subscription_form").length == 0){ var apiService = "channels_subscribe"; data["channels_id"] = subsChannels; } else if(oldToken && oldToken != ""){ var apiService = "refresh_token"; data["device_old_token"] = oldToken; } else{ var apiService = "savetoken"; } smpushDestroyReqWindow(false); jQuery.ajax({ method: "POST", url: "https://sanmarglive.com/?smpushcontrol="+apiService, data: data }) .done(function( msg ) { smpushWelcomeMSG(); jQuery(".smpush-push-subscriptions-button").attr("disabled","disabled"); jQuery(".smpush-push-subscriptions-button").html("Saved"); smpush_debug("Data Sent"); if(0 == 1){ smpushUpdateGPS(); } smpush_link_user_cookies(); }); } function smpush_endpoint_unsubscribe(subscriptionId) { jQuery("#smpushIconRequest").tooltipster("content","Give us a permission to receive push notification messages and we will keep you posted !"); if(subscriptionId == ""){ return false; } jQuery.ajax({ method: "POST", url: "https://sanmarglive.com/?smpushcontrol=deletetoken", data: { device_token: subscriptionId, device_type: devicetype, firebase: 1} }) .done(function( msg ) { smpush_debug("Data Sent"); smpush_setCookie("smpush_linked_user", "false", -1); smpush_setCookie("smpush_safari_device_token", "false", -1); smpush_setCookie("smpush_device_token", "false", -1); smpush_setCookie("smpush_desktop_request", "false", -1); smpush_setCookie("smpush_desktop_welcmsg_seen", "false", -1); smpush_setCookie("smpush_desktop_blocked", "true", 365); }); } function smpush_test_browser(){ if("safari" in window && "pushNotification" in window.safari){ return true; } if (typeof(ServiceWorkerRegistration) != "undefined" && ("showNotification" in ServiceWorkerRegistration.prototype)) { return true; } if(Notification.permission === "denied"){ return false; } return false; } function smpush_browser() { if("safari" in window){ return "safari"; } if (navigator.userAgent.indexOf(" OPR/") >= 0) { return "opera"; } if (navigator.userAgent.indexOf("Edge") >= 0) { return "edge"; } if (navigator.userAgent.match(/chrome/i)) { return "chrome"; } if (navigator.userAgent.match(/SamsungBrowser/i)) { return "samsung"; } if (navigator.userAgent.match(/firefox/i)) { return "firefox"; } } function smpush_bootstrap_init(){ jQuery(".smpush-push-resubscribe-button").click(function() { smpush_debug("resubscribe clicked."); if(smpush_getCookie("smpush_desktop_blocked") == "true" && "native" == "subs_page"){ smpush_setCookie("smpush_desktop_blocked", "false", -1); window.location.reload(false); } }); if(settings[devicetype] == 0){ smpush_debug("Browser support is closed by admin settings"); return; } var pushSupported = smpush_test_browser(); if(! pushSupported){ smpushDrawUnSupportedPopup(); smpush_debug("Browser not support push notification"); return; } if(smpush_getCookie("smpush_desktop_request") != "true" && smpush_getCookie("smpush_desktop_blocked") != "true"){ jQuery("body").append("<style></style>"); setTimeout(function(){ smpushDrawReqWindow() }, 0); } else{ smpush_link_user_cookies(); if(0 == 1){ smpushUpdateGPS(); } } setTimeout(function(){ smpushDrawReqIcon(); if ("safari" in window) { smpushSafari(); } else { smpushGeko(); } }, 0); } function smpushUpdateGPS(){ if(smpush_getCookie("smpush_device_token") != "" && smpush_getCookie("smart_push_smio_coords_latitude") == ""){ if (! navigator.geolocation) { smpush_debug("Geolocation is not supported for this Browser/OS."); return; } var geoSuccess = function(startPos) { smpush_debug(startPos.coords.latitude); smpush_debug(startPos.coords.longitude); smpush_setCookie("smart_push_smio_coords_latitude", startPos.coords.latitude, (1/24)); smpush_setCookie("smart_push_smio_coords_longitude", startPos.coords.longitude, (1/24)); smpush_endpoint_subscribe(smpush_getCookie("smpush_device_token"), ""); }; var geoError = function(error) { smpush_debug("Error occurred. Error code: " + error.code); /*0: unknown error, 1: permission denied, 2: position unavailable (error response from location provider), 3: timed out*/ }; navigator.geolocation.getCurrentPosition(geoSuccess); } } function smpushDestroyReqWindow(dismiss){ jQuery("#smart_push_smio_window").remove(); jQuery("#smart_push_smio_overlay").remove(); if(dismiss){ var requestAgainPeriod = 1; } else{ var requestAgainPeriod = 365; } smpush_setCookie("smpush_desktop_request", "true", requestAgainPeriod); if("0" == "2" && jQuery("#SMIOPayToReadButton").length > 0 && smpush_getCookie("smpush_device_token") != ""){ location.reload(); } } function smpushHidePopup(){ if("0" == "1"){ smpushDrawUnSupportedPopup(); } else { smpushDestroyReqWindow(true); } } function smpushDrawNotifyPopup(){ if("0" != "1")return; jQuery("#smart_push_smio_window").remove(); jQuery("#smart_push_smio_overlay").remove(); jQuery("body").append('<style> #smart_push_smio_window{ direction:ltr;display:none;max-width: 87%;z-index:99999999;font-family: Helvetica Neue, Helvetica, Arial, sans-serif;text-align:left;margin-top: 5px;border: 1px solid rgb(170, 170, 170);background: rgb(251, 251, 251);width: 320px;font-size: 13px;padding: 12px 12px 12px 6px;border-radius: 2px;box-shadow: rgba(0, 0, 0, 0.298039) 0px 2px 1px 0px; } #smart_push_smio_window:after { bottom: 100%;left: 20%;border: solid transparent;content: " ";height: 0;width: 0;position: absolute;pointer-events: none;border-color: rgba(255, 255, 255, 0);border-bottom-color: #fff;border-width: 10px;margin-left: -10px; } #smart_push_smio_close{ position: absolute;right: 5px;top: 2px;background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAIAAABGNLJTAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABpSURBVChTzZBLCsAgDER7Zg9iCDmqSzd9MCJtbSvunEXI540kHnVFm9LuHhGlFJUklDRVohvNLKWUc4ZDJJQ02/hBQ5iZDEKJNNt43LsbRhS90Hp1TneU2Fe6Gv6ulOHzyrUfnGoXutYTA3eKL8daaukAAAAASUVORK5CYII=");width: 12px;height: 13px;cursor: pointer; } #smart_push_smio_logo{ border:0;float:left;width:24px;height:24px; } #smart_push_smio_msg{ margin:2px 0 20px 30px;width: 100%;font-weight: 300; } #smart_push_smio_note{ display:none; } #smart_push_smio_agreement{ margin: 10px 0;font-weight: 300;color: #6d7471;font-size: 12px; } #smart_push_smio_footer{ text-align: right; } #smart_push_smio_not_allow{ display: inline-block;width: 80px;border-radius: 1px;border: 1px solid rgb(170, 170, 170);box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 1px 0px;text-align: center;padding: 4px 2px 5px;cursor: pointer;background: #fff;text-transform: none;color:#000;font-weight:300; } #smart_push_smio_allow{ display: inline-block;width: 80px;border-radius: 1px;border: 1px solid rgb(170, 170, 170);box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 1px 0px;text-align: center;padding: 4px 2px 5px;cursor: pointer;background: #fff;text-transform: none;color:#000;font-weight:300; } </style> <div id="smart_push_smio_overlay" tabindex="-1" style="opacity:0.9; display: none;ms-filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=40); background-color:#000; position: fixed; left: 0; right: 0; top: 0; bottom: 0; z-index: 10000;"></div> <div id="smart_push_smio_window" class=""> <div id="smart_push_smio_close" onclick="smpushDestroyReqWindow(true)" style="display:none!important"></div> <img id="smart_push_smio_logo" src="https://sanmarglive.com/wp-content/uploads/2020/04/mobile-logo-sanmarglive-e1587659998713.jpeg" /> <p id="smart_push_smio_msg">Keep me posted</p> <p id="smart_push_smio_note"></p> <div id="smart_push_smio_footer"> <button type="button" onclick="smpushDestroyReqWindow(true)" id="smart_push_smio_not_allow">Ignore</button> <button type="button" class="smpush-push-permission-button" id="smart_push_smio_allow" disabled>Subscribe</button> </div> </div> '); document.getElementById("smart_push_smio_overlay").style.opacity = "0.9"; document.getElementById("smart_push_smio_window").style.position = "fixed"; if("1" == "1"){ document.getElementById("smart_push_smio_overlay").style.display = "block"; } document.getElementById("smart_push_smio_window").style.display = "block"; document.getElementById("smart_push_smio_window").style.left = ((window.innerWidth/2) - (document.getElementById("smart_push_smio_window").offsetWidth/2)) + "px"; document.getElementById("smart_push_smio_window").style.top = ((window.innerHeight/2) - (document.getElementById("smart_push_smio_window").offsetHeight/2)) + "px"; } function smpushDrawUnSupportedPopup(){ if("0" != "1")return; jQuery("#smart_push_smio_window").remove(); jQuery("#smart_push_smio_overlay").remove(); jQuery("body").append('<style> #smart_push_smio_window{ direction:ltr;display:none;max-width: 87%;z-index:99999999;font-family: Helvetica Neue, Helvetica, Arial, sans-serif;text-align:left;margin-top: 5px;border: 1px solid rgb(170, 170, 170);background: rgb(251, 251, 251);width: 320px;font-size: 13px;padding: 12px 12px 12px 6px;border-radius: 2px;box-shadow: rgba(0, 0, 0, 0.298039) 0px 2px 1px 0px; } #smart_push_smio_window:after { bottom: 100%;left: 20%;border: solid transparent;content: " ";height: 0;width: 0;position: absolute;pointer-events: none;border-color: rgba(255, 255, 255, 0);border-bottom-color: #fff;border-width: 10px;margin-left: -10px; } #smart_push_smio_close{ position: absolute;right: 5px;top: 2px;background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAIAAABGNLJTAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABpSURBVChTzZBLCsAgDER7Zg9iCDmqSzd9MCJtbSvunEXI540kHnVFm9LuHhGlFJUklDRVohvNLKWUc4ZDJJQ02/hBQ5iZDEKJNNt43LsbRhS90Hp1TneU2Fe6Gv6ulOHzyrUfnGoXutYTA3eKL8daaukAAAAASUVORK5CYII=");width: 12px;height: 13px;cursor: pointer; } #smart_push_smio_logo{ border:0;float:left;width:24px;height:24px; } #smart_push_smio_msg{ margin:2px 0 20px 30px;width: 100%;font-weight: 300; } #smart_push_smio_note{ display:none; } #smart_push_smio_agreement{ margin: 10px 0;font-weight: 300;color: #6d7471;font-size: 12px; } #smart_push_smio_footer{ text-align: right; } #smart_push_smio_not_allow{ display: inline-block;width: 80px;border-radius: 1px;border: 1px solid rgb(170, 170, 170);box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 1px 0px;text-align: center;padding: 4px 2px 5px;cursor: pointer;background: #fff;text-transform: none;color:#000;font-weight:300; } #smart_push_smio_allow{ display: inline-block;width: 80px;border-radius: 1px;border: 1px solid rgb(170, 170, 170);box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 1px 0px;text-align: center;padding: 4px 2px 5px;cursor: pointer;background: #fff;text-transform: none;color:#000;font-weight:300; } </style> <div id="smart_push_smio_overlay" tabindex="-1" style="opacity:0.9; display: none;ms-filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=40); background-color:#000; position: fixed; left: 0; right: 0; top: 0; bottom: 0; z-index: 10000;"></div> <div id="smart_push_smio_window" class=""> <div id="smart_push_smio_close" onclick="smpushDestroyReqWindow(true)" style="display:none!important"></div> <img id="smart_push_smio_logo" src="https://sanmarglive.com/wp-content/uploads/2020/04/mobile-logo-sanmarglive-e1587659998713.jpeg" /> <p id="smart_push_smio_msg">Keep me posted</p> <p id="smart_push_smio_note"></p> <div id="smart_push_smio_footer"> <button type="button" onclick="smpushDestroyReqWindow(true)" id="smart_push_smio_not_allow">Ignore</button> <button type="button" class="smpush-push-permission-button" id="smart_push_smio_allow" disabled>Subscribe</button> </div> </div> '); document.getElementById("smart_push_smio_overlay").style.opacity = "0.9"; document.getElementById("smart_push_smio_window").style.position = "fixed"; if("1" == "1"){ document.getElementById("smart_push_smio_overlay").style.display = "block"; } document.getElementById("smart_push_smio_window").style.display = "block"; document.getElementById("smart_push_smio_window").style.left = ((window.innerWidth/2) - (document.getElementById("smart_push_smio_window").offsetWidth/2)) + "px"; document.getElementById("smart_push_smio_window").style.top = ((window.innerHeight/2) - (document.getElementById("smart_push_smio_window").offsetHeight/2)) + "px"; document.getElementById("smart_push_smio_allow").style.display = "none"; } function smpushIntializePopupBox(){ jQuery("#smart_push_smio_window").remove(); jQuery("#smart_push_smio_overlay").remove(); jQuery("body").append('<style> #smart_push_smio_window{ direction:ltr;display:none;max-width: 87%;z-index:99999999;font-family: Helvetica Neue, Helvetica, Arial, sans-serif;text-align:left;margin-top: 5px;border: 1px solid rgb(170, 170, 170);background: rgb(251, 251, 251);width: 320px;font-size: 13px;padding: 12px 12px 12px 6px;border-radius: 2px;box-shadow: rgba(0, 0, 0, 0.298039) 0px 2px 1px 0px; } #smart_push_smio_window:after { bottom: 100%;left: 20%;border: solid transparent;content: " ";height: 0;width: 0;position: absolute;pointer-events: none;border-color: rgba(255, 255, 255, 0);border-bottom-color: #fff;border-width: 10px;margin-left: -10px; } #smart_push_smio_close{ position: absolute;right: 5px;top: 2px;background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAIAAABGNLJTAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABpSURBVChTzZBLCsAgDER7Zg9iCDmqSzd9MCJtbSvunEXI540kHnVFm9LuHhGlFJUklDRVohvNLKWUc4ZDJJQ02/hBQ5iZDEKJNNt43LsbRhS90Hp1TneU2Fe6Gv6ulOHzyrUfnGoXutYTA3eKL8daaukAAAAASUVORK5CYII=");width: 12px;height: 13px;cursor: pointer; } #smart_push_smio_logo{ border:0;float:left;width:24px;height:24px; } #smart_push_smio_msg{ margin:2px 0 20px 30px;width: 100%;font-weight: 300; } #smart_push_smio_note{ display:none; } #smart_push_smio_agreement{ margin: 10px 0;font-weight: 300;color: #6d7471;font-size: 12px; } #smart_push_smio_footer{ text-align: right; } #smart_push_smio_not_allow{ display: inline-block;width: 80px;border-radius: 1px;border: 1px solid rgb(170, 170, 170);box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 1px 0px;text-align: center;padding: 4px 2px 5px;cursor: pointer;background: #fff;text-transform: none;color:#000;font-weight:300; } #smart_push_smio_allow{ display: inline-block;width: 80px;border-radius: 1px;border: 1px solid rgb(170, 170, 170);box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 1px 0px;text-align: center;padding: 4px 2px 5px;cursor: pointer;background: #fff;text-transform: none;color:#000;font-weight:300; } </style> <div id="smart_push_smio_overlay" tabindex="-1" style="opacity:0.9; display: none;ms-filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=40); background-color:#000; position: fixed; left: 0; right: 0; top: 0; bottom: 0; z-index: 10000;"></div> <div id="smart_push_smio_window" class=""> <div id="smart_push_smio_close" onclick="smpushDestroyReqWindow(true)" style="display:none!important"></div> <img id="smart_push_smio_logo" src="https://sanmarglive.com/wp-content/uploads/2020/04/mobile-logo-sanmarglive-e1587659998713.jpeg" /> <p id="smart_push_smio_msg">Keep me posted</p> <p id="smart_push_smio_note">Give us a permission to sending you push notification messages and we will keep you posted !</p> <div id="smart_push_smio_footer"> <button type="button" onclick="smpushDestroyReqWindow(true)" id="smart_push_smio_not_allow">Ignore</button> <button type="button" class="smpush-push-permission-button" id="smart_push_smio_allow" disabled>Subscribe</button> </div> </div> '); document.getElementById("smart_push_smio_overlay").style.opacity = "0.9"; document.getElementById("smart_push_smio_window").style.position = "fixed"; if("1" == "1"){ document.getElementById("smart_push_smio_overlay").style.display = "block"; } document.getElementById("smart_push_smio_window").style.display = "block"; var position = "topcenter"; if(position == "topright"){ document.getElementById("smart_push_smio_window").style.right = "10px"; document.getElementById("smart_push_smio_window").style.top = "10px"; } else if(position == "topleft"){ document.getElementById("smart_push_smio_window").style.left = "10px"; document.getElementById("smart_push_smio_window").style.top = "10px"; } else if(position == "bottomright"){ document.getElementById("smart_push_smio_window").style.bottom = "10px"; document.getElementById("smart_push_smio_window").style.right = "10px"; } else if(position == "bottomleft"){ document.getElementById("smart_push_smio_window").style.left = "10px"; document.getElementById("smart_push_smio_window").style.bottom = "10px"; } else if(position == "topcenter"){ document.getElementById("smart_push_smio_window").style.left = ((window.innerWidth/2) - (document.getElementById("smart_push_smio_window").offsetWidth/2)) + "px"; document.getElementById("smart_push_smio_window").style.top = "0"; } else{ document.getElementById("smart_push_smio_window").style.left = ((window.innerWidth/2) - (document.getElementById("smart_push_smio_window").offsetWidth/2)) + "px"; document.getElementById("smart_push_smio_window").style.top = ((window.innerHeight/2) - (document.getElementById("smart_push_smio_window").offsetHeight/2)) + "px"; } } function smpushDrawReqWindow(){ if("native" == "popup"){ smpushIntializePopupBox(); } else if("native" == "subs_page"){ } else{ if("0" == "1"){ jQuery("body").append('<div id="smart_push_smio_overlay" tabindex="-1" style="opacity:0.9; display: block;ms-filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=40); background-color:#000; position: fixed; left: 0; right: 0; top: 0; bottom: 0; z-index: 10000;"></div>'); } jQuery("body").append("<button class=\"smpush-push-permission-button\" style=\"display:none\" disabled>Subscribe</button>"); } } function smpushDrawReqIcon(){ if("0" == "1" || smpush_getCookie("smpush_desktop_blocked") == "true"){ jQuery("body").append("<div class=\"tooltip_templates\"><div id=\"smpush_tooltip_gdpr_ver_text\"><img src=\"https://sanmarglive.com/wp-content/uploads/2020/04/mobile-logo-sanmarglive-e1587659998713.jpeg\" /><p>Give us a permission to receive push notification messages and we will keep you posted !</p><p id=\"smpush_gdpr_hint\">By proceeding in this form you will receive our marketing notifications and agree to our #Privacy Policy# and #Terms of Use#</p></div></div>"); jQuery("body").append("<button class=\"smpush-push-permission-button smpush-push-remove-block smpushTooltip\" id=\"smpushIconRequest\" style=\"bottom: 10px; right: 10px;\" data-tooltip-content=\"#smpush_tooltip_gdpr_ver_text\" disabled></button>"); } else if("native" == "icon" || smpush_getCookie("smpush_desktop_blocked") == "true"){ jQuery("body").append("<button class=\"smpush-push-permission-button smpush-push-remove-block smpushTooltip\" id=\"smpushIconRequest\" style=\"bottom: 10px; right: 10px;\" title=\"Give us a permission to receive push notification messages and we will keep you posted !\" disabled></button>"); } else{ return; } if("0" == "1"){ jQuery("body").append('<div id="smart_push_smio_overlay" tabindex="-1" style="opacity:0.9; display: block;ms-filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=40); background-color:#000; position: fixed; left: 0; right: 0; top: 0; bottom: 0; z-index: 10000;"></div>'); } jQuery("body").append("<style>#smpushIconRequest{display: block;position: fixed;width: 48px;height: 48px;background-image: url(https://sanmarglive.com/wp-content/uploads/2020/04/mobile-logo-sanmarglive-e1587659998713.jpeg);background-repeat: no-repeat;background-position: center;background-size: 48px 48px;text-indent: -9999px;padding: 0;margin: 0;border: 0;z-index: 999999999;border-radius: 50px;-webkit-border-radius: 50px;-moz-border-radius: 50px;-webkit-box-shadow: 7px 3px 16px 0px rgba(50, 50, 50, 0.2);-moz-box-shadow: 7px 3px 16px 0px rgba(50, 50, 50, 0.2);box-shadow:7px 3px 16px 0px rgba(50, 50, 50, 0.2);}</style>"); smpushTooltip(); jQuery(".smpush-push-remove-block").click(function() { smpush_debug("remove block clicked."); if(smpush_getCookie("smpush_desktop_blocked") == "true"){ smpush_setCookie("smpush_desktop_blocked", "false", -1); } }); } function smpush_link_user_cookies() { if(smpush_getCookie("smpush_fresh_linked_user") != "" && smpush_getCookie("smpush_linked_user") == "" && smpush_getCookie("smpush_device_token") != ""){ smpush_endpoint_subscribe(smpush_getCookie("smpush_device_token"), ""); smpush_setCookie("smpush_linked_user", "true", 15); smpush_setCookie("smpush_fresh_linked_user", "", -1); } } function smpushWelcomeMSG(){ if(smpush_getCookie("smpush_desktop_welcmsg_seen") == "true"){ return; } if("0" == "1"){ setTimeout(function(){ window.location=""; }, 4000); } if("1" == "0"){return;} smpush_setCookie("smpush_desktop_welcmsg_seen", "true", 365); if("safari" in window){ var n = new Notification( "Thanks You for Subscribing to push", { "body": "You will start recieving news alerts from us shortly. Go to homepage.", "tag" : "https://sanmarglive.com" } ); n.onclick = function () { this.close(); window.open("https://sanmarglive.com", "_blank"); }; } else{ navigator.serviceWorker.ready.then(function(registration) { registration.showNotification("Thanks You for Subscribing to push", { icon: "https://sanmarglive.com/wp-content/uploads/2020/04/mobile-logo-sanmarglive-e1587659998713.jpeg", body: "You will start recieving news alerts from us shortly. Go to homepage.", tag: "https://sanmarglive.com", data: {target: "https://sanmarglive.com"}, requireInteraction: true }); }); } } function smpush_setCookie(cname, cvalue, exdays) { var d = new Date(); d.setTime(d.getTime() + (exdays*24*60*60*1000)); var expires = "expires="+d.toUTCString(); document.cookie = cname + "=" + cvalue + "; " + expires + ";path=/"; } function smpush_getCookie(cname) { var name = cname + "="; var ca = document.cookie.split(";"); for(var i=0; i<ca.length; i++) { var c = ca[i]; while (c.charAt(0)==" "){ c = c.substring(1); } if (c.indexOf(name) == 0) return c.substring(name.length,c.length); } return ""; } function smpushTooltip() { jQuery(".smpushTooltip").tooltipster({side: "left", contentCloning: true, interactive: true}); } if ("safari" in window && "pushNotification" in window.safari) { document.addEventListener("DOMContentLoaded", function(event) { smpush_bootstrap_init(); }); } else{ window.addEventListener("load", function() { smpush_bootstrap_init(); }); } function openFBpopup(url, elm){ var new_fbwindow = window.open(url, "", "width=800,height=600"); new_fbwindow.onbeforeunload = function(){ $(elm).hide(); } } "use strict"; if(("0" == "0" || "0" == 0 ) && ("0" == "0" || "0" == 0 ) && ("1" == "0" || "0" == "1")){ window.addEventListener("load", function() { smpush_debug("manifest registered successfully"); document.getElementsByTagName("HEAD")[0].insertAdjacentHTML("afterbegin", "<link rel=\"manifest\" href=\"https://sanmarglive.com/smart_manifest.js?version=9.541\">"); }); } function smpush_sendSubscriptionToServer(subscriptionId, old_token) { smpush_debug("sending to server...", subscriptionId); smpush_endpoint_subscribe(subscriptionId, old_token); } function smpush_unsubscribe() { smpush_setCookie("smpush_desktop_request", "true", 10); var pushButton = jQuery(".smpush-push-permission-button"); pushButton.attr("disabled","disabled"); const messaging = firebase.messaging(); messaging.getToken().then((currentToken) => { messaging.deleteToken(currentToken); smpush_endpoint_unsubscribe(currentToken); smpush_isPushEnabled = false; pushButton.removeAttr("disabled"); pushButton.html("Subscribe"); }).catch(function(e) { smpush_debug("failed unsubscribe...", e); return; }); } function smpush_subscribe() { if(smpush_getCookie("smpush_desktop_blocked") == "true" && "0" == "0"){ smpush_debug("User unsubscribed using unsubscrib button"); return; } var pushButton = jQuery(".smpush-push-permission-button"); pushButton.attr("disabled","disabled"); if(firebaseInitialized){ smpush_sendSubscriptionToServer(smpush_getCookie("smpush_device_token")); return; } var smpush_firebaseConfig = JSON.parse('{"apiKey":"AIzaSyA_Bl2twUh0Tg8jkj0qxU2jrRw8XcDGkkw","authDomain":"sanmarg-live-f3752.firebaseapp.com","databaseURL":"https://sanmarg-live-f3752.firebaseio.com","projectId":"sanmarg-live-f3752","storageBucket":"sanmarg-live-f3752.appspot.com","messagingSenderId":"806264326600","appId":"1:806264326600:web:612c7947c605d3334f98fd","measurementId":"G-3Y347BT018"}'); firebase.initializeApp(smpush_firebaseConfig); const messaging = firebase.messaging(); firebaseInitialized = true; navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) { messaging.useServiceWorker(serviceWorkerRegistration); messaging.requestPermission().then(function() { smpush_debug("Notification permission granted."); messaging.getToken().then((currentToken) => { if (currentToken) { smpush_debug("Token fetched.", currentToken); smpush_isPushEnabled = true; pushButton.html("Unsubscribe"); jQuery("#smpushIconRequest").tooltipster("content","Unsubscribe from receiving our notifications and delete your subscription"); pushButton.removeAttr("disabled"); if(smpush_getCookie("smpush_device_token") != "" && smpush_getCookie("smpush_device_token") != currentToken){ smpush_sendSubscriptionToServer(currentToken, smpush_getCookie("smpush_device_token")); } else if(smpush_getCookie("smpush_device_token") == "") { smpush_sendSubscriptionToServer(currentToken, ""); } } else { smpush_debug("No Instance ID token available. Request permission to generate one."); } }).catch((err) => { smpush_debug("An error occurred while retrieving token. ", err); }); }).catch(function(err) { if (Notification.permission === "denied") { smpush_isPushEnabled = false; smpush_debug("Permission for Notifications is denied"); smpushHidePopup(); pushButton.attr("disabled","disabled"); smpush_endpoint_unsubscribe(smpush_getCookie("smpush_device_token")); } else { smpush_debug(err); } }); messaging.onMessage((spayload) => { smpush_debug("Message received. ", spayload); let payload = spayload.notification; if (typeof(payload.command) != "undefined" && payload.command != "") { eval(payload.command); } serviceWorkerRegistration.showNotification(payload.title, payload); }); messaging.onTokenRefresh(() => { messaging.getToken().then((refreshedToken) => { smpush_debug("Token refreshed.", refreshedToken); smpush_sendSubscriptionToServer(currentToken, smpush_getCookie("smpush_device_token")); }).catch((err) => { smpush_debug("Unable to retrieve refreshed token ", err); }); }); }); } function smpush_initialiseState() { if (!("showNotification" in ServiceWorkerRegistration.prototype)) { smpush_debug("Notifications aren't supported."); return; } if (Notification.permission === "denied") { smpushHidePopup(); smpush_debug("The user has blocked notifications."); smpush_endpoint_unsubscribe(smpush_getCookie("smpush_device_token")); return; } if (!("PushManager" in window)) { smpush_debug("Push messaging isn't supported."); return; } jQuery(".smpush-push-permission-button").removeAttr("disabled"); if (Notification.permission === "granted") { smpush_subscribe(); } else if (Notification.permission === "default" && "native" == "native") { smpush_subscribe(); } } function smpushGeko(){ self.addEventListener("notificationclick", function(event) { smpush_debug("notificationclick. ", event); if (typeof(event.notification.data.click) != "undefined" && event.notification.data.click != "") { eval(event.notification.data.click); } if (typeof(event.action) != "undefined" && event.action != "") { eval(event.notification.data.actions[event.action]); return; } if(event.notification.data.target == ""){ return; } event.waitUntil(clients.matchAll({ type: "window" }).then(function(clientList) { for (let i = 0; i < clientList.length; i++) { let client = clientList[i]; if (client.url === event.notification.data.target && "focus" in client) { return client.focus(); } } if (clients.openWindow) { return clients.openWindow(event.notification.data.target); } })); event.notification.close(); }); if ("serviceWorker" in navigator) { navigator.serviceWorker.register("https://sanmarglive.com/smart_firebase_sw.js").then(smpush_initialiseState).catch(function(error){ smpush_debug(error); }); } else { smpush_debug("Service workers aren't supported in this browser."); } if(jQuery(".smpush-push-permission-button").length < 1){ return false; } jQuery(".smpush-push-permission-button").click(function() { smpush_debug("clicked.", smpush_isPushEnabled); if (smpush_isPushEnabled) { smpush_unsubscribe(); } else { smpush_subscribe(); } }); jQuery(".smpush-push-subscriptions-button").click(function() { smpush_subscribe(); }); } function smpushSafari(){ var pushButton = jQuery(".smpush-push-permission-button"); pushButton.removeAttr("disabled"); if(smpush_getCookie("smpush_safari_device_token") != ""){ pushButton.html("Unsubscribe"); jQuery("#smpushIconRequest").tooltipster("content","Unsubscribe from receiving our notifications and delete your subscription"); } else{ pushButton.html("Subscribe"); } pushButton.click(function() { var permissionData = window.safari.pushNotification.permission(""); smpushCheckRemotePermission(permissionData); }); jQuery(".smpush-push-subscriptions-button").click(function() { var permissionData = window.safari.pushNotification.permission(""); smpushCheckRemotePermission(permissionData); }); if("native" == "native"){ document.getElementsByClassName("smpush-push-permission-button")[0].click(); } } var smpushCheckRemotePermission = function (permissionData) { var pushButton = jQuery(".smpush-push-permission-button"); if (permissionData.permission === "default") { window.safari.pushNotification.requestPermission( "https://sanmarglive.com/snmpush/safari", "", {}, smpushCheckRemotePermission ); } else if (permissionData.permission === "denied") { if(smpush_getCookie("smpush_safari_device_token") != ""){ smpush_endpoint_unsubscribe(smpush_getCookie("smpush_safari_device_token")); } smpush_setCookie("smpush_desktop_request", "true", 10); smpush_setCookie("smpush_safari_device_token", "false", -1); smpush_setCookie("smpush_device_token", "false", -1); smpushHidePopup(); } else if (permissionData.permission === "granted") { smpushDestroyReqWindow(false); if(smpush_getCookie("smpush_safari_device_token") != ""){ smpush_endpoint_unsubscribe(smpush_getCookie("smpush_safari_device_token")); smpush_setCookie("smpush_desktop_request", "true", 10); smpush_setCookie("smpush_safari_device_token", "false", -1); smpush_setCookie("smpush_device_token", "false", -1); smpush_setCookie("smpush_desktop_welcmsg_seen", "false", -1); pushButton.attr("disabled","disabled"); jQuery(".smpush-push-subscriptions-button").attr("disabled","disabled"); jQuery(".smpush-push-subscriptions-button").html("Saved"); } else{ if(smpush_getCookie("smpush_safari_device_token") == ""){ smpush_setCookie("smpush_safari_device_token", permissionData.deviceToken, 365); smpush_endpoint_subscribe(permissionData.deviceToken, ""); } else{ smpushDestroyReqWindow(false); } pushButton.attr("disabled","disabled"); jQuery(".smpush-push-subscriptions-button").attr("disabled","disabled"); jQuery(".smpush-push-subscriptions-button").html("Saved"); } } }; 