function class_Constants(){this.PLUGIN_MESSAGING={english:{back:"BACK",byAuthor:function(a){return"By "+a},cart:"Your cart",chooseAmount:"Choose amount",cancel:"CANCEL",close:"CLOSE",continueWithoutSaving:"CONTINUE WITHOUT SAVING",dateStr:"DATE",forThisArticle:"FOR THIS ARTICLE",learnMore:["This is your shopping cart","Add to your cart for articles you like","Pay when you're ready. There are no deadlines"],minutes:"Minutes",partnerLink:function(a){return'An <a href="https://orcsnet.com/" target="_blank" rel="nofollow" style="color:'+a+';">Orcsnet</a> Partner Website'},pay:"PAY",payLater:"PAY LATER",payNow:"PAY NOW",pending:"PENDING",pgCosts:"PG COSTS",pgFeesExtra:"*PG Fees addl.",rupeeSymbol:"₹",save:"SAVE",saveForLater:"SAVE FOR LATER",subtotal:"SUBTOTAL",thankYou:"Thank you for your support",totalStr:"TOTAL",visits:"Visits",yourActivity:"Your activity",yourCart:"Your cart",yourInvoice:"Your invoice",monthly:"MONTHLY",annual:"ANNUAL",oneTime:"ONE-TIME",autodebit:"AUTO-DEBIT"},hindi:{cart:"रकम का पिटारा",pending:"रकम का पिटारा",chooseAmount:"रकम चुनें",yourInvoice:"आपकी रसीद",yourCart:"रकम का पिटारा",partnerLink:function(a){return'<a href="https://orcsnet.com/" target="_blank" rel="nofollow" style="color:'+a+';">ओर्क्स्नेट</a> पार्टनर साईट'},payNow:"भुगतान करें",payLater:"बाद में भुगतान करें",saveForLater:"बाद में भुगतान करें",close:"खाली है!",cancel:"वापस जाएँ",byAuthor:function(a){return a+" द्वारा"},dateStr:"तारीख",subtotal:"सहोयग राशि",pgCosts:"गेटवे लागत",totalStr:"कुल",pay:"भुगतान करें",forThisArticle:"इस लेख के लिए",back:"रद्द करें / वापस जाएँ",thankYou:"आपके सहयोग के लिए धन्यवाद",continueWithoutSaving:"आगे बढे",learnMore:["यह आपकी शॉपिंग कार्ट है","अपनी पसंद के लेखों के लिए अपनी कार्ट में जोड़ें","जब आप तैयार हों तब भुगतान करें","कोई समय सीमा नहीं है"],yourActivity:"आपकी गतिविधि",visits:"दौरा",minutes:"मिनट",rupeeSymbol:"₹"},tamil:{rupeeSymbol:"ரூ.",chooseAmount:"தொகையைத் தேர்வு செய்யுங்கள்",yourActivity:"உங்கள் செயல்பாடு",visits:"வருகைகள்",minutes:"நிமிடங்கள்"}}}function class_LocalStorage(){var a=function(a){return a&&JSON.parse(atob(a))||null},b=function(a){return btoa(JSON.stringify(a))},c=function(a){return a.substring("orcsnet:q:".length)},d=function(a){return"orcsnet:q:"+String(a)},e=function(a){return 0===a.indexOf("orcsnet:q:")},f=function(){};this.listeners=[],this.registerListener=function(a){this.listeners.push(a)},this.eventQ={},this._loadEventIntoQ=function(a,b){b?this.eventQ[a]=b:delete this.eventQ[a],this.listeners.forEach(function(a){a()})},this.loadFromLS=function(){if(this.localStorageAvailable)for(var b in window.localStorage)if(e(b)){var d=c(b),g=a(window.localStorage.getItem(b));g&&(g.url=decodeURIComponent(g.url),g.title=decodeURIComponent(g.title),g.author=decodeURIComponent(g.author),f("[loadFromLS]: @["+d+"]: "+g.author+" | "+g.amt)),this._loadEventIntoQ(d,g)}},this.flushQ=function(){if(this.localStorageAvailable){for(var a in window.localStorage)e(a)&&window.localStorage.removeItem(a);this.eventQ={}}},this.init=function(){if(this.localStorageAvailable){this.loadFromLS();var b=this;window.addEventListener("storage",function(d){if(e(d.key)){var g=c(d.key),h=a(d.newValue);h&&(h.url=decodeURIComponent(h.url),h.title=decodeURIComponent(h.title),h.author=decodeURIComponent(h.author),f("[storage-listener]: @["+g+"]: "+h.author+" | "+h.amt)),b._loadEventIntoQ(g,h)}})}},this.addEventToQ=function(a){var c=(new Date).valueOf();f("[addEventToQ]: @["+c+"]: "+a.author+" | "+a.amt);var e={};for(var g in a)a.hasOwnProperty(g)&&(e[g]=a[g]);a.url=encodeURIComponent(a.url),a.title=encodeURIComponent(a.title),a.author=encodeURIComponent(a.author),this.localStorageAvailable&&window.localStorage.setItem(d(c),b(a)),this._loadEventIntoQ(c,e)},this.getCurrentState=function(){var a=Object.keys(this.eventQ);a.sort(),a.reverse();var b=[],c=[];return a.forEach(function(a){for(var d=this.eventQ[a],e=!1,g=0;g<c.length;g++)if(c[g].url===d.url){e=!0;break}e||(f("[LS.getCurrentState] @["+a+"]: "+d.author+" | "+d.amt),c.push({url:d.url}),d.amt>0&&b.push(d))},this),b}}function class_Payments(a){"use strict";this.app=a,this.afterPayment=function(a){if(this.app.parsedParams.localStorageAvailable){window.localStorage.setItem("orcsnet:last_payment",(new Date).valueOf()),window.localStorage.setItem("orcsnet:last_payment_date",a.pdate),window.localStorage.setItem("orcsnet:last_payment_type",a.ptype),window.localStorage.setItem("orcsnet:last_payment_amt",a.amt_paise),window.localStorage.setItem("orcsnet:last_payment_to",this.app.parsedParams.ownerid);var b=window.localStorage.getItem("orcsnet:npayments")||0;window.localStorage.setItem("orcsnet:npayments",String(1+Number(b)))}this.app.sendEvent_v2({action:"payment-success",amount:a.amt_paise/100,payment_id:a.payment_id,ptype:a.ptype})},this.rpSubscriptionOptions=function(a){var b=this,c={key:"",account_id:d,name:this.app.configMgr.getConfigVal("ownerName"),description:"An Orcsnet partner website",handler:function(c){b.afterPayment({pdate:(new Date).valueOf(),ptype:"subscription",amt_paise:a.notes.button_amount,payment_id:c.razorpay_payment_id}),a.onsuccess&&a.onsuccess(c.razorpay_payment_id,null,a.subscription_id)},modal:{ondismiss:function(){document.getElementById("orcsnet").style.height="",a.ondismiss&&a.ondismiss()}},notes:a.notes,image:this.app.configMgr.getConfigVal("rplogoUrl")||this.app.configMgr.getConfigVal("logoUrl"),theme:{color:this.app.configMgr.getConfigVal("rpColor")||this.app.configMgr.getConfigVal("bgColor")},subscription_id:a.subscription_id,prefill:{}},d=this.app.configMgr.getConfigVal("submerchantAccountId");return d?(c.key=this.app.configMgr.getConfigVal("rppartnerkey"),c.account_id=d):c.key=this.app.configMgr.getConfigVal("rpmasterkey"),c},this.rpOptions=function(a){var b=this,c={name:this.app.configMgr.getConfigVal("ownerName"),description:"An Orcsnet partner website",handler:function(c){b.afterPayment({pdate:(new Date).valueOf(),ptype:"one-time",amt_paise:a.notes.button_amount,payment_id:c.razorpay_payment_id}),a.onsuccess&&a.onsuccess(c.razorpay_payment_id)},modal:{ondismiss:function(){document.getElementById("orcsnet").style.height="",a.ondismiss&&a.ondismiss()}},notes:a.notes,image:this.app.configMgr.getConfigVal("rplogoUrl")||this.app.configMgr.getConfigVal("logoUrl"),theme:{color:this.app.configMgr.getConfigVal("rpColor")},amount:String(a.amount),currency:a.currency||"INR"},d=this.app.configMgr.getConfigVal("submerchantAccountId");d?(c.key=this.app.configMgr.getConfigVal("rppartnerkey"),c.account_id=d):c.key=this.app.configMgr.getConfigVal("rpmasterkey");var e=this.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:useremail")||null;e&&(c.prefill=c.prefill||{},c.prefill.email||(c.prefill.email=e));var f=this.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:userphone")||null;return f&&(c.prefill=c.prefill||{},c.prefill.contact||(c.prefill.contact=f)),c},this.addFees=function(a){var b={button_amount:a,amount_to_pay:a,fees:0,base_amount:a,base_amount_gst:0};return b},this.createOrderNotes=function(a){var b=AWS.config.credentials.identityId||"unavailable";b=b.replace("ap-south-1:","").replace(/-/g,"");var c={cmpuid:b,pubname:this.app.parsedParams.ownerid,channel:this.app.parsedParams.channel,content_id:this.app.parsedParams.content_url||this.app.parsedParams.channel,configname:this.app.subconfigName,button_amount:Math.round(100*a.button_amount),payment_type:a.payment_type,currency:a.currency||"INR"};return a.userpan&&(c.PAN=a.userpan),a.firstName&&(c.firstName=a.firstName),a.lastName&&(c.lastName=a.lastName),a.supporterName&&(c.supporterName=a.supporterName),a.supporterEmail&&(c.supporterEmail=a.supporterEmail),a.supportChannel&&(c.channel=a.supportChannel),a.vsubemail&&(c.vsubemail=a.vsubemail),a.location&&(c.location=a.location),c},this.payWithPayTMSpot=function(a){return},this.payWithCCAvenue=function(a){var b=this.createOrderNotes(a);b.ccavenue=1;var c=b.cmpuid+String((new Date).valueOf());b.order_id=(b.pubname+"-"+md5(c)).substr(0,30),b.paid_amount=Math.round(100*a.amount_to_pay);var d,e="https://ccavenue.orcsnet.com",f=this;window.addEventListener("message",function(c){var g=c.origin||c.originalEvent.origin;if(g===e)if("ready"===c.data.state){var h={order:{orderid:b.order_id,custid:b.cmpuid,txn_amt:a.amount_to_pay}};Plugin.log("sending order:"),Plugin.log(h),d.postMessage(h,e)}else"ccavenue-failure"===c.data.status?(d&&d.close(),a.callbacks&&a.callbacks.ccavenuefail&&a.callbacks.ccavenuefail(c.data.response_code)):"success"===c.data.status&&(d&&d.close(),f.afterPayment({pdate:(new Date).valueOf(),ptype:"one-time",amt_paise:a.amount_to_pay}),a.callbacks&&a.callbacks.success&&a.callbacks.success())}),new AWS.Lambda({region:"ap-south-1"}).invoke({FunctionName:"PayTMCreateOrder",Payload:JSON.stringify({order:b})},function(){}),d=open(e);var g=setInterval(function(){(!d||d.closed)&&(a.callbacks&&a.callbacks.ccavenuefail&&a.callbacks.ccavenuefail("window-closed"),clearInterval(g))},1e3)},this.payWithRazorpay_Spot=function(a){document.getElementById("orcsnet").style.height="600px";var b=this.rpOptions({amount:Math.round(100*a.amount_to_pay),currency:a.currency||"INR",ondismiss:a.callbacks.ondismiss,onsuccess:a.callbacks.onsuccess,notes:this.createOrderNotes(a)});a.usermethod&&(b.prefill=b.prefill||{},b.prefill.method=a.usermethod),a.email&&(b.prefill=b.prefill||{},b.prefill.email=a.email),a.phone&&(b.prefill=b.prefill||{},b.prefill.contact=a.phone),Plugin.log(b);var c=new Razorpay(b);c.open()},this.payWithRazorpay_SubMerchantAccountSubscription=function(a){try{document.getElementById("orcsnet").style.height="600px"}finally{}var b=this,c=new AWS.Lambda({region:"ap-south-1"});c.invoke({FunctionName:"CreateSubscription",Payload:JSON.stringify({pubname:b.app.parsedParams.ownerid,planAmount:String(a.plan_amount),planFrequency:a.subscription_type})},function(c,d){if(c)a.callbacks.onerror&&a.callbacks.onerror(c);else{var e=JSON.parse(d.Payload);if(e.error)a.callbacks.onerror&&a.callbacks.onerror(e.error);else{var f=b.rpSubscriptionOptions({subscription_id:e.subscription_id,ondismiss:a.callbacks.ondismiss,onsuccess:a.callbacks.onsuccess,notes:b.createOrderNotes({button_amount:a.plan_amount,payment_type:"subscription"})});f.notes.psId=e.plan_id+"."+e.subscription_id,f.notes.frequency=a.subscription_type,a.usermethod&&(f.prefill=f.prefill||{},f.prefill.method=a.usermethod),a.email&&(f.prefill=f.prefill||{},f.prefill.email=a.email),a.phone&&(f.prefill=f.prefill||{},f.prefill.contact=a.phone),a.userpan&&(f.notes.PAN=a.userpan),a.firstName&&(f.notes.firstName=a.firstName),a.lastName&&(f.notes.lastName=a.lastName),a.supporterName&&(f.notes.supporterName=a.supporterName),a.supporterEmail&&(f.notes.supporterEmail=a.supporterEmail),a.supportChannel&&(f.notes.channel=a.supportChannel),a.location&&(f.notes.location=a.location),Plugin.log(f);var g=new Razorpay(f);g.open()}}})}}function class_Config(a){this.app=a,this.constants=new class_Constants,this.config=null,this.scfg=null,this.getS3Config=function(a,b){var c;c=this.app.localhost?"http://localhost:9005/plugin_config/":"https://plugin.orcsnet.com/plugin_config/",this.app.parsedParams.test_config&&(c+="test_config/"),c+="root"===a?this.app.parsedParams.ownerid+".json":this.app.parsedParams.ownerid+"."+a+".json",this.app.parsedParams.force_refresh&&!this.app.localhost&&(c+="?force="+(new Date).getTime());var d=new XMLHttpRequest;d.open("GET",c,!0),d.onreadystatechange=function(){4===this.readyState&&(200===this.status?this.responseText.trim()&&b("root"===a?JSON.parse(this.responseText.trim()):JSON.parse(this.responseText.trim())):(console.log("failed to fetch "+c),b(null)))},d.send()},this.getChannelConfig=function(a){this.config=a,this.config||this.onChannelConfig(null),this.scname=this.app.parsedParams.channel;var b=this.app.parsedParams.content_url;b&&a.urlOverride&&b.toLowerCase()===a.urlOverride.url.toLowerCase()&&(this.scname=a.urlOverride.scname),"youtube"===this.scname&&a.defaultYouTubeChannel&&(console.log("switching to default channel "+a.defaultYouTubeChannel),this.scname=a.defaultYouTubeChannel),this.app.subconfigName=this.scname,this.getS3Config(this.scname,this.onChannelConfig.bind(this))},this.onChannelConfig=function(a){this.scfg=a,this.scfg&&"youtube"===this.scfg.sctype&&"youtube"!==this.scfg.scname&&(this.app.parsedParams.channel="youtube-"+this.scname),this.app.onValidConfig()},this.getUxv2Flow=function(a){return a&&this.uxv2Flows.hasOwnProperty(a)?this.uxv2Flows[a]:this.scfg&&this.scfg.hasOwnProperty("uxv2.flow")?this.scfg["uxv2.flow"]:this.config&&this.config.hasOwnProperty("uxv2.flow")?this.config["uxv2.flow"]:this.uxv2Flows.subvsub},this.uxv2Flows={std:{name:"std",start:"p_cta_1",transitions:{p_cta_1:{c_next:"p_methodselection_1"},p_methodselection_1:{c_back:"p_cta_1",c_next:"p_gotopg"},p_gotopg:{c_back:"p_methodselection_1"},p_invoice_1:{ui:{}}},endscreen:"p_invoice_1"},sub:{name:"sub",start:"p_cta_1",transitions:{p_cta_1:{c_next:"p_amtfreq"},p_amtfreq:{c_back:"p_cta_1",c_next:"p_methodselection_1"},p_methodselection_1:{c_back:"p_amtfreq",c_next:"p_gotopg"},p_gotopg:{c_back:"p_methodselection_1"},p_invoice_1:{ui:{}}},endscreen:"p_invoice_1"},subkyc:{name:"subkyc",start:"p_cta_1",transitions:{p_cta_1:{c_next:"p_amtfreq"},p_amtfreq:{c_back:"p_cta_1",c_next:"p_kyc_1"},p_kyc_1:{c_back:"p_amtfreq",c_next:"p_methodselection_1"},p_methodselection_1:{c_back:"p_amtfreq",c_next:"p_gotopg"},p_gotopg:{c_back:"p_methodselection_1"},p_invoice_1:{ui:{}}},endscreen:"p_invoice_1"},vsub:{name:"vsub",start:"p_vsub_1",transitions:{p_vsub_1:{c_next:{condition_var:"ptype",instant:"p_gotopg","vsub.subscription.monthly":"p_vsub_get_email"}},p_vsub_get_email:{c_back:"p_vsub_1",c_next:"p_gotopg"},p_gotopg:{c_back:"p_vsub_1"},p_invoice_1:{ui:{}}},endscreen:"p_invoice_1"},subvsub:{name:"subvsub",start:"p_sub_vsub_cta",transitions:{p_sub_vsub_cta:{c_next:"p_gotopg"},p_gotopg:{c_back:"p_sub_vsub_cta"},p_invoice_1:{ui:{}}},endscreen:"p_invoice_1"},poll:{name:"poll",start:"p_cta_poll_ask",transitions:{p_cta_poll_ask:{c_next:"p_gotopg"},p_gotopg:{c_back:"p_cta_poll_ask"},p_invoice_1:{ui:{}}},endscreen:"p_invoice_1"}},this.getConfigVal=function(a){return this.scfg&&this.scfg.hasOwnProperty(a)?this.scfg[a]:this.config&&this.config.hasOwnProperty(a)?this.config[a]:this.uxv2&&this.publisherConfig.uxv2.hasOwnProperty(a)?this.publisherConfig.uxv2[a]:this.publisherConfig["default"][a]},this.getStringVal=function(a){return this.scfg&&this.scfg.strings&&this.scfg.strings.hasOwnProperty(a)?this.scfg.strings[a]:this.config&&this.config.strings&&this.config.strings.hasOwnProperty(a)?this.config.strings[a]:this.uxv2&&this.language&&this.stringPack.hasOwnProperty(a)&&this.stringPack[a].hasOwnProperty(this.language)?this.stringPack[a][this.language]:this.uxv2&&this.stringPack.hasOwnProperty(a)&&this.stringPack[a].hasOwnProperty("english")?this.stringPack[a].english:this.publisherConfig["default"][a]||""},this.stringPack={support:{english:"SUPPORT",hindi:"हमें सहयोग दीजिये",urdu:"مدد کریں"},tryAnother1:{english:"Trouble with payment gateway?",hindi:"पेमेंट गेटवे असफल?",urdu:"ادائیگی ناکام ہے"},tryAnother2:{english:"Try another",hindi:"दोबारा ट्राय करें",urdu:"دوبارہ کوشش کریں"},thankYou:{english:"Thank you",hindi:"धन्यवाद",urdu:"شکریہ"},how_would_you_like_to_support_us:{english:"How would you like to support us?",hindi:"आप हमारा समर्थन कैसे करना चाहेंगे?"},justOnce:{english:"Just Once",hindi:"एक बार"},oneTime:{english:"ONE-TIME",hindi:"एक बार"},monthlyAutoDebit:{english:"Monthly Auto-Debit",hindi:"मासिक ऑटो डेबिट"},annualAutoDebit:{english:"Annual Auto-Debit",hindi:"वार्षिक ऑटो-डेबिट"},monthlyViaEmail:{english:"Monthly Via Email",hindi:"ईमेल के माध्यम से मासिक"},autoDebitsAreSupportedOn:{english:"AUTO-DEBITS are supported on Indian Visa/ Mastercard credit cards",hindi:"AUTO-DEBITS को भारतीय वीजा / मास्टरकार्ड क्रेडिट कार्ड का समर्थन किया जाता है।"},authorize:{english:"AUTHORIZE",hindi:"अनुदान प्राधिकरण"},weWillSendPlanDetails:{english:"We will send your plan details to the email you provide in the next step.",hindi:"हम आपके विवरण को आपके द्वारा अगले चरण में प्रदान की गई ईमेल पर भेज देंगे।"},youAreOnAPlan:{english:"You are already on a plan!",hindi:"आपके पास पहले से ही एक सहायता योजना है"},monthly:{english:"monthly",hindi:"महीने के"},everyMonth:{english:"Every month",hindi:"हर महीने"},everyThreeMonths:{english:"Every 3 months",hindi:"हर तीन महिने"},everyYear:{english:"Every year",hindi:"हर साल"},manageVSub:{english:"Manage this plan",hindi:"इस सदस्यता को प्रबंधित करें"},whereShouldWeSendReminder:{english:"Where should we send next month's reminder?",hindi:"हमें अगले महीने का रिमाइंडर कहां भेजना चाहिए"},yourEmail:{english:"your email",hindi:"आपका ईमेल"},next:{english:"NEXT",hindi:"अगला कदम"},"continue":{english:"Continue",hindi:"अगला कदम"},needEmail:{english:"We need an email address to send next month's payment link. No spam.",hindi:"हमें अगले महीने के रिमाइंडर के लिए एक ईमेल पते की आवश्यकता है"},howWouldYouLikeToPay:{english:"And how would you like to pay?",hindi:"आप कैसे पैसे देना पंसद करेंगे"},cardBankEtc:{english:"Card, Bank, etc.",hindi:"कार्ड, बैंक आदि"},paytmWallet:{english:"PayTM Wallet",hindi:"पेटीएम वॉलेट"},otherWallets:{english:"Other wallets",hindi:"अन्य वॉलेट"},tryAgain:{english:"Try again",hindi:"पुनः प्रयास करें"},citizenOfIndia:{english:"I hereby declare that I am a citizen of India",hindi:"मैं यह घोषणा करता हूं कि मैं भारत का नागरिक हूं"},amountPaid:{english:"Amount paid",hindi:"राशि"},back:{english:"back",hindi:"वापस"}},this.currencyConfig={INR:{name:"INR",symbol:"₹",amounts:[100,250],range:[10,1e4]},USD:{name:"USD",symbol:"$",amounts:[5,10],range:[1,100]},EUR:{name:"EUR",symbol:"€",amounts:[5,10],range:[1,100]},AED:{name:"AED",symbol:"AED",amounts:[10,20],range:[5,500]},AUD:{name:"AUD",symbol:"A$",amounts:[5,10],range:[1,100]}},this.publisherConfig={"default":{flow:"subvsub",international:!1,subscriptions:!1,vsubscriptions:!1,rpmasterkey:"rzp_live_CfH4Q5XXguxnY4",rppartnerkey:"rzp_live_partner_BCZPsu08cVbYui",borderDef:"border: 1px solid grey; border-radius: 3px;",btnBrdrWth:"3px",fgcontrols:"#1f2746",fontWt:"300",fontFamily:"Roboto, serif",headerBrdDef:"",headerCTAFtSz:"18",leftBrdDef:"",leftCTAFtSz:"16",cta_hr_mt:"10px",cta_left_lh:"",cta_tnc_mrt:"5px",headerHt:"200",headerImgHt:"120",outerPadding:"10px",showLogo:"header",ctaMarginTop:"40",ctaMarginBottom:"30",containerHt:"140",back:this.constants.PLUGIN_MESSAGING.english.back,byAuthor:this.constants.PLUGIN_MESSAGING.english.byAuthor,cancel:this.constants.PLUGIN_MESSAGING.english.cancel,cart:this.constants.PLUGIN_MESSAGING.english.cart,chooseAmount:this.constants.PLUGIN_MESSAGING.english.chooseAmount,close:this.constants.PLUGIN_MESSAGING.english.close,continueWithoutSaving:this.constants.PLUGIN_MESSAGING.english.continueWithoutSaving,dateStr:this.constants.PLUGIN_MESSAGING.english.dateStr,forThisArticle:this.constants.PLUGIN_MESSAGING.english.forThisArticle,learnMore:this.constants.PLUGIN_MESSAGING.english.learnMore,minutes:this.constants.PLUGIN_MESSAGING.english.minutes,partnerLink:this.constants.PLUGIN_MESSAGING.english.partnerLink,pay:this.constants.PLUGIN_MESSAGING.english.pay,payLater:this.constants.PLUGIN_MESSAGING.english.payLater,payNow:this.constants.PLUGIN_MESSAGING.english.payNow,pending:this.constants.PLUGIN_MESSAGING.english.pending,pgCosts:this.constants.PLUGIN_MESSAGING.english.pgCosts,pgFeesExtra:this.constants.PLUGIN_MESSAGING.english.pgFeesExtra,rupeeSymbol:this.constants.PLUGIN_MESSAGING.english.rupeeSymbol,save:this.constants.PLUGIN_MESSAGING.english.save,saveForLater:this.constants.PLUGIN_MESSAGING.english.saveForLater,subtotal:this.constants.PLUGIN_MESSAGING.english.subtotal,thankYou:this.constants.PLUGIN_MESSAGING.english.thankYou,totalStr:this.constants.PLUGIN_MESSAGING.english.totalStr,visits:this.constants.PLUGIN_MESSAGING.english.visits,yourActivity:this.constants.PLUGIN_MESSAGING.english.yourActivity,yourCart:this.constants.PLUGIN_MESSAGING.english.yourCart,yourInvoice:this.constants.PLUGIN_MESSAGING.english.yourInvoice,monthly:this.constants.PLUGIN_MESSAGING.english.monthly,annual:this.constants.PLUGIN_MESSAGING.english.annual,oneTime:this.constants.PLUGIN_MESSAGING.english.oneTime,autodebit:this.constants.PLUGIN_MESSAGING.english.autodebit},uxv2:{}}}function class_Plugin(){"use strict";this.positioning={},this.payments=new class_Payments(this),this.configMgr=new class_Config(this),this.init=function(a){Plugin.log("[Plugin.app.init]"),this.localhost=!1,this.localhost&&(Plugin.log=function(a){Plugin.app.parsedParams?console.log("["+Plugin.app.parsedParams.iframe_id+"]: ",a):console.log(a)},Plugin.log("[Plugin.app.init]: starting console logger")),this.parsedParams=a,this.configMgr.getS3Config("root",this.configMgr.getChannelConfig.bind(this.configMgr))},this.setupLocalTracker=function(){if(!this.parsedParams.localStorageAvailable)return void this.sendEvent_v2({action:"no-localstorage"});var a=this.parsedParams.ownerid,b=function(b){return"orcsnet:"+b+":"+a},c=function(a){return Number(localStorage.getItem(b(a)))},d=this;if("plugin"===this.parsedParams.channel)setTimeout(function(){var a=c("site-visits")+1,e=(new Date).valueOf();localStorage.setItem(b("site-visits"),String(a)),localStorage.setItem(b("last-visit"),String(e));var f=c("site-seconds")+15;localStorage.setItem(b("site-seconds"),String(f)),d.sendEvent_v2({action:"stats",site_visits:String(a),site_seconds:String(f),last_visit:String(e)});var g=5;setInterval(function(){var a=c("site-seconds")+g;localStorage.setItem(b("site-seconds"),String(a))},1e3*g)},15e3);else{var e=this.parsedParams.channel,f=c(e+"-visits")+1,g=(new Date).valueOf();localStorage.setItem(b(e+"-visits"),String(f)),localStorage.setItem(b(e+"-last-visit"),String(g)),d.sendEvent_v2({action:"c-stats",channel_visits:String(f),last_visit:String(g)})}},this.sendMsgToParent=function(a){this.parsedParams.iframe_id&&this.origin&&(a.iframe_id=this.parsedParams.iframe_id,window.parent.postMessage(a,this.origin))},this.sendHeight=function(){var a=document.getElementById("orcsnet").getClientRects();if(a.length>0){var b=a[0].height;this.nTimesWeDidntSendHt||(this.nTimesWeDidntSendHt=1,this.nTimesWeDidntSendHtLimit=20),this.nTimesWeDidntSendHt++,(b!==this.plugin_ht||this.nTimesWeDidntSendHt>this.nTimesWeDidntSendHtLimit)&&(this.sendMsgToParent({action:"height",height:b}),this.plugin_ht=b,this.nTimesWeDidntSendHt=1,this.nTimesWeDidntSendHtLimit*=2,this.nTimesWeDidntSendHtLimit>300&&(this.nTimesWeDidntSendHtLimit=300))}},this.sendScrollIntoView=function(){this.sendMsgToParent({action:"scroll-into-view"})},this.requestPositioning=function(){this.sendMsgToParent({action:"send-positioning"})},this.sendPositioning=function(){this.sendMsgToParent({action:"set-positioning",positioning:this.positioning})},this.pluginMessageHandler=function(a){var b=a.origin||a.originalEvent.origin;if(b===this.origin){var c=a.data;c&&c.positioning&&(this.positioning=c.positioning,Plugin.log("[Plugin.app.pluginMessageHandler]: rcvd positioning "+JSON.stringify(this.positioning))),c&&c.getrootconfig&&this.sendMsgToParent({rootconfig:this.configMgr.config}),c&&c.getchannelconfig&&this.sendMsgToParent({channelconfig:this.configMgr.scfg}),c&&c.getuxv2flow&&this.sendMsgToParent({uxv2flow:this.configMgr.getUxv2Flow()}),c&&c.setrootconfig&&(this.configMgr.config=c.setrootconfig,this.backToFront()),c&&c.setchannelconfig&&(this.configMgr.scfg=c.setchannelconfig,this.backToFront()),c&&c.setorientation&&(this.parsedParams.orientation=c.setorientation,this.backToFront())}},this.calcVSubLinkId=function(a){return"orcsnet-l-"+md5(a.toLowerCase()+this.parsedParams.ownerid+this.parsedParams.channel)},this.getSavedVSub=function(a,b){var c="https://plugin.orcsnet.com/vsubs/"+this.calcVSubLinkId(a)+".json",d=new XMLHttpRequest;d.open("GET",c,!0),d.onreadystatechange=function(){4===this.readyState&&b(200===this.status&&this.responseText.trim()?JSON.parse(this.responseText.trim()):null)},d.send()},this.thisUrlExists=function(){return-1<this.unpaid.findIndex({url:Plugin.app.parsedParams.content_url})},this.onValidConfig=function(){if(Plugin.log("[Plugin.app.onValidConfig]: ready"),"samachara"!==this.parsedParams.ownerid||this.localhost||"plugin"!==this.parsedParams.channel)if(this.parsedParams.wp_link){var a=this.parsedParams.wp_link.split("/");this.origin=a[0]+"//"+a[2]}else this.parsedParams.origin?this.origin=this.parsedParams.origin:this.origin=this.configMgr.getConfigVal("contentUrl");else this.origin="https://www.samachara.com";this.parsedParams.content_url||(this.parsedParams.content_url=this.configMgr.getConfigVal("contentUrl")),this.configMgr.language=this.parsedParams.language||this.configMgr.getConfigVal("language")||"english",this.firstTimeUser=!1,this.startTime=(new Date).valueOf(),setInterval(this.sendHeight.bind(this),100),window.addEventListener("message",this.pluginMessageHandler.bind(this)),this.storage=new class_LocalStorage,this.storage.localStorageAvailable=this.parsedParams.localStorageAvailable,this.storage.init(),this.parsedParams.channel=this.parsedParams.channel.trim(),this.configMgr.config?"supportkl"===this.parsedParams.channel?this.ux="supportkl":"the-wire"===this.parsedParams.ownerid&&"support"===this.parsedParams.channel?this.ux="supportthewire":"support"===this.parsedParams.channel?this.ux="supportpage":this.ux="allinone":this.ux="no-such-account","plugin"===this.parsedParams.channel&&"http://ippodhu.com/support-ippodhu/"===this.parsedParams.content_url&&(this.ux="allinone",this.channel="support",this.parsedParams.channel="support"),this.configMgr.getConfigVal("uxv2")&&(this.ux="uxv2"),"uxv2"===this.parsedParams.ux&&(this.ux="uxv2"),"uxv3"===this.parsedParams.ux&&(this.ux="uxv3"),"uxv2"===this.ux&&(this.configMgr.uxv2=!0);var b=this.parsedParams.channel.indexOf(",");b>-1&&(this.parsedParams.channel=this.parsedParams.channel.substring(0,b).trim()),this.parsedParams.subscriptionManagement&&(this.ux="subscription-management");var c=this;this.storage.registerListener(function(){c.currentView&&c.currentView.updateCart&&c.currentView.updateCart()}),AWS.config.region="ap-south-1",AWS.config.correctClockSkew=!0,AWS.config.credentials&&AWS.config.credentials.clearCachedId(),AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:"ap-south-1:8c5554f0-5d82-47a3-9215-4e3f1d0f334c"}),c.fbtf=!1,AWS.config.credentials.get(function(){"default"!==c.parsedParams.ownerid&&c.setupLocalTracker(),c.fbtf||c.backToFront()}),setTimeout(function(){c.fbtf||c.backToFront()},2e3)},this.backToFront=function(){switch(this.fbtf=!0,this.unpaid=new Backbone.Collection(this.storage.getCurrentState()),this.ux){case"no-such-account":break;case"supportkl":this.loadSupportKL();break;case"supportthewire":this.loadSupportTheWire();break;case"supportpage":this.loadSupportPage();break;case"allinone":this.loadAllInOne();break;case"uxv2":this.loadUxv2();break;case"uxv3":this.loadUxv3();break;case"subscription-management":this.loadSubscriptionManagement();break;default:this.loadAllInOne()}},this.packageRoyaltyForJson=function(a){var b={version:2,to:a.to,url:encodeURIComponent(a.url),amt:100*a.amt};return b},this.sendEvent=function(a){},this.sendEvent_v2=function(a){return},this.shouldHide=function(){if(this.last_payment_date=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:last_payment_date")||null,this.last_payment_type=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:last_payment_type")||null,this.last_payment_amt=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:last_payment_amt")||0,this.last_payment_to=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:last_payment_to")||null,this.configMgr.getConfigVal("hideAfterPayment")&&this.parsedParams.ownerid===this.last_payment_to&&"plugin"===this.parsedParams.channel){var a=(new Date).valueOf(),b=864e5;if(this.last_payment_amt>1e4&&this.last_payment_amt<1e5&&a-this.last_payment_date<=15*b)return!0;if(this.last_payment_amt>=1e5&&this.last_payment_amt<5e5&&a-this.last_payment_date<=30*b)return!0;if(this.last_payment_amt>=5e5&&a-this.last_payment_date<=60*b)return!0}return!1},this.getPollResults=function(a,b){var c,d=new XMLHttpRequest;c=this.localhost?"http://localhost:9005/poll-results/":"https://plugin.orcsnet.com/poll-results/",d.open("GET",c+"result."+a+".json",!0),d.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){if(this.responseText.trim()){var a=JSON.parse(this.responseText.trim());b&&b(a)}}else b&&b({})},d.send()},this.submitPollResponse=function(a,b,c){var d={cmpuid:AWS.config.credentials.identityId,pollname:a,pollrsp:b};Plugin.app.storage.localStorageAvailable&&localStorage.setItem("orcsnet:poll:"+a,b),Plugin.log("sending: "+JSON.stringify(d));var e=new AWS.SQS({region:"ap-south-1"});e.sendMessage({QueueUrl:"https://ap-south-1.queue.amazonaws.com/084183956366/poll-responses",MessageBody:JSON.stringify(d)},function(a,b){c&&c()})},this.loadAllInOne=function(){this.shouldHide()||(this.currentView&&this.currentView.close(),this.currentView=null,this.currentView=new Plugin.Views.AllInOne({el:document.getElementById("orcsnet")}),this.currentView.render())},this.loadUxv2=function(){this.currentView&&this.currentView.close(),this.currentView=null,this.currentView=new Plugin.Views.Uxv2({el:document.getElementById("orcsnet")}),this.currentView.render()},this.loadUxv3=function(){this.currentView&&this.currentView.close(),this.currentView=null,this.currentView=new Plugin.Views.Uxv3({el:document.getElementById("orcsnet")}),this.currentView.render()},this.loadSupportKL=function(){this.currentView&&this.currentView.close(),this.currentView=null,this.currentView=new Plugin.Views.SupportKL({el:document.getElementById("orcsnet")}),this.currentView.render()},this.loadSupportTheWire=function(){this.currentView&&this.currentView.close(),this.currentView=null;var a=this,b=function(){window.Razorpay?a.currentView=new Plugin.Views.SupportTheWire({el:document.getElementById("orcsnet")}):(console.log("loadSupportTheWire:tryAgain"),setTimeout(b,500))};b()},this.loadSupportPage=function(){this.currentView&&this.currentView.close(),this.currentView=null;var a=this,b=function(){window.Razorpay?a.currentView=new Plugin.Views.SupportPage({el:document.getElementById("orcsnet")}):(console.log("loadSupportPage:tryAgain"),setTimeout(b,500))};b()},this.loadSubscriptionManagement=function(){this.currentView&&this.currentView.close(),this.currentView=null,"lookup"===this.parsedParams.subscriptionManagement.action?(this.currentView=new Plugin.Views.LookupSubscription({el:document.getElementById("orcsnet")}),this.currentView.subid=this.parsedParams.subscriptionManagement.subid||null,this.currentView.startup()):"cancel"===this.parsedParams.subscriptionManagement.action?(this.currentView=new Plugin.Views.CancelSubscription({el:document.getElementById("orcsnet")}),this.currentView.subid=this.parsedParams.subscriptionManagement.subid,this.currentView.token=this.parsedParams.subscriptionManagement.token||null,this.currentView.startup()):console.log("unknown value for action: "+this.parsedParams.subscriptionManagement.action)},this.checkFirstTimeUser=function(a){this.parsedParams.localStorageAvailable&&(Plugin.log("[Plugin.app.checkFirstTimeUser]"),window.localStorage.getItem("orcsnet:firstTimeClicked")||(window.localStorage.setItem("orcsnet:firstTimeClicked",1),this.firstTimeUser=!0,this.sendEvent_v2({action:"first-time-user"})))}}Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.SupportKL=Backbone.NativeView.extend({initialize:function(){this.monthly=!1,Plugin.app.subconfigName="supportkl"},events:{"click #monthly":"toggleMonthly","click #makemonthly":"makeMonthly","click #makeonce":"makeOnce","click .pay-now":"payNow"},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},render:function(){this.el.innerHTML=JST["app/scripts/templates/KhabarLahariya/SupportKL-2.ejs"].apply({monthly:this.monthly
}),setTimeout(function(){Plugin.app.requestPositioning()},200)},renderThankYou:function(){this.el.innerHTML=JST["app/scripts/templates/KhabarLahariya/ThankYou.ejs"].apply({payment_id:this.payment_id,payment_type:this.payment_type,feeStruct:this.feeStruct,monthly:this.monthly})},toggleMonthly:function(a){this.monthly=!this.monthly,this.render()},makeMonthly:function(a){this.monthly=!0,this.render()},makeOnce:function(a){this.monthly=!1,this.render()},payNow:function(a){a.preventDefault();var b=a.delegateTarget||a.currentTarget||a.target,c=Number(b.getAttribute("data-amt"));document.getElementById("orcsnet").style.height="600px",setTimeout(function(){Plugin.log("sendScrollIntoView"),Plugin.app.sendScrollIntoView()},500),this.feeStruct=Plugin.app.payments.addFees(c),this.payment_type=this.monthly?"kl-monthly":"instant";var d={cmpuid:AWS.config.credentials.identityId.replace("ap-south-1:","").replace(/-/g,""),pubname:Plugin.app.parsedParams.ownerid,channel:Plugin.app.parsedParams.channel,content_id:Plugin.app.parsedParams.content_url,configname:Plugin.app.subconfigName,button_amount:Math.round(100*this.feeStruct.button_amount),payment_type:this.payment_type},e=this,f=Plugin.app.payments.rpOptions({amount:Math.round(100*this.feeStruct.amount_to_pay),name:Plugin.app.configMgr.getConfigVal("ownerName"),description:"An Orcsnet partner website",image:Plugin.app.configMgr.getConfigVal("rplogoUrl"),ondismiss:function(){e.render()},notes:d,onsuccess:this.showReceipt.bind(this)}),g=new Razorpay(f);g.open()},showReceipt:function(a){this.payment_id=a,this.renderThankYou()}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.SupportTheWire=Backbone.NativeView.extend({initialize:function(){if(this.origin="http://support.thewire.in/","orcsnet"===Plugin.app.parsedParams.theWireSupportPage.origin&&(this.origin="https://support-the-wire.orcsnet.com/"),this.amount=Number(Plugin.app.parsedParams.theWireSupportPage.amount),this.amount<=0)return console.log("invalid amount provided"),void window.parent.postMessage({status:"failure",error:"invalid amount"},this.origin);this.currency=Plugin.app.parsedParams.theWireSupportPage.currency;var a=["AED","ALL","AMD","ARS","AUD","AWG","BBD","BDT","BMD","BND","BOB","BSD","BWP","BZD","CAD","CHF","CNY","COP","CRC","CUP","CZK","DKK","DOP","DZD","EGP","ETB","EUR","FJD","GBP","GIP","GMD","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","JMD","KES","KGS","KHR","KYD","KZT","LAK","LBP","LKR","LRD","LSL","MAD","MDL","MKD","MMK","MNT","MOP","MUR","MVR","MWK","MXN","MYR","NAD","NGN","NIO","NOK","NPR","NZD","PEN","PGK","PHP","PKR","QAR","RUB","SAR","SCR","SEK","SGD","SLL","SOS","SSP","SVC","SZL","THB","TTD","TZS","USD","UYU","UZS","YER","ZAR"];if(a.indexOf(this.currency)<0&&(console.log("unknown currency "+this.currency),this.currency="INR"),this.firstName=Plugin.app.parsedParams.theWireSupportPage.firstName||"",this.lastName=Plugin.app.parsedParams.theWireSupportPage.lastName||"",this.firstName=this.firstName.trim(),this.lastName=this.lastName.trim(),!this.firstName&&!this.lastName)return console.log("need a name"),void window.parent.postMessage({status:"failure",error:"need a name"},this.origin);this.pan=Plugin.app.parsedParams.theWireSupportPage.pan||"",this.pan=this.pan.trim().toUpperCase();var b=!1;if(b){if(!this.pan)return console.log("need a pan"),void window.parent.postMessage({status:"failure",error:"need a pan"},this.origin);if(!this.isValidPan(this.pan))return console.log("invalid pan"),void window.parent.postMessage({status:"failure",error:"invalid pan"},this.origin)}if(this.email=Plugin.app.parsedParams.theWireSupportPage.email||"",this.email=this.email.trim(),!this.email)return console.log("need an email"),void window.parent.postMessage({status:"failure",error:"need an email"},this.origin);if(this.phone=Plugin.app.parsedParams.theWireSupportPage.phone||"",this.phone=this.phone.trim(),!this.phone)return console.log("need a phone"),void window.parent.postMessage({status:"failure",error:"need a phone"},this.origin);switch(this.supportChannel=Plugin.app.parsedParams.theWireSupportPage.supportChannel||null,Plugin.app.subconfigName="SupportTheWire",this.frequency=Plugin.app.parsedParams.theWireSupportPage.frequency,"s"===this.frequency&&(this.frequency="single"),"m"===this.frequency&&(this.frequency="monthly"),"y"===this.frequency&&(this.frequency="yearly"),this.frequency){case"single":this.singlePayment();break;case"monthly":case"yearly":this.spellItOut();break;default:console.log("invalid frequency provided"),window.parent.postMessage({status:"failure",error:"invalid frequency"},this.origin)}},events:{"click .proceed":"subscribe","click .cancel":"cancelPayment"},spellItOut:function(){var a="ONE MONTH";"yearly"===this.frequency&&(a="ONE YEAR"),this.el.innerHTML=JST["app/scripts/templates/Standard/SubscriptionConfirmation.ejs"].apply({fontFamily:Plugin.app.configMgr.getConfigVal("fontFamily"),duration:a,logoUrl:Plugin.app.configMgr.getConfigVal("logoUrl"),bgColor:Plugin.app.configMgr.getConfigVal("theme-secondary")})},cancelPayment:function(a){window.parent.postMessage({status:"failure",error:"user changed mind"},this.origin)},showSuccessMessage:function(){this.el.innerHTML=JST["app/scripts/templates/TheWire/SubscriptionSuccess.ejs"].apply({email:this.email})},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},isValidPan:function(a){if(!a)return!1;if(a=a.toUpperCase().replace(/ /g,""),10!==a.length)return!1;var b=a.substring(0,3),c=a.substring(3,4),d=a.substring(4,5),e=a.substring(5,9),f=a.substring(9,10),g=b&&b.match(/[A-Z]+/);if(!g)return!1;var g=c&&c.match(/[CPHFATBLJG]/);if(!g)return!1;var g=d&&d.match(/[A-Z]/);if(!g)return!1;var g=e&&e.match(/[0-9]+/);if(!g)return!1;var g=f&&f.match(/[A-Z]/);return g?!0:!1},singlePayment:function(){var a=this;Plugin.app.payments.payWithRazorpay_Spot({button_amount:this.amount,amount_to_pay:this.amount,currency:this.currency,payment_type:"instant",callbacks:{onsuccess:function(b){a.showSuccessMessage(),window.parent.postMessage({status:"success",response:b,ptype:"single"},a.origin)},ondismiss:function(){window.parent.postMessage({status:"failure",error:"user closed window"},a.origin)}},firstName:this.firstName,lastName:this.lastName,userpan:this.pan,email:this.email,phone:this.phone});var b=function(){var a=document.getElementsByClassName("razorpay-backdrop");a.length>0?(console.log("changing background of razorpay-backdrop"),a[0].style.background="lightgray"):setTimeout(b,100)};b()},subscribe:function(a){this.el.innerHTML=JST["app/scripts/templates/Standard/PleaseWait.ejs"].apply({fontFamily:Plugin.app.configMgr.getConfigVal("fontFamily"),logoUrl:Plugin.app.configMgr.getConfigVal("logoUrl"),bgColor:Plugin.app.configMgr.getConfigVal("theme-secondary")});var b=this;Plugin.app.payments.payWithRazorpay_SubMerchantAccountSubscription({plan_amount:this.amount,subscription_type:this.frequency,userpan:this.pan,firstName:this.firstName,lastName:this.lastName,email:this.email,phone:this.phone,supportChannel:this.supportChannel,callbacks:{onerror:function(a){console.log(a),window.parent.postMessage({status:"failure",error:"error",details:a},b.origin)},ondismiss:function(){window.parent.postMessage({status:"failure",error:"user closed window"},b.origin)},onsuccess:function(a){b.showSuccessMessage(),window.parent.postMessage({status:"success",response:a,ptype:"subscription"},b.origin)}}});var c=function(){var a=document.getElementsByClassName("razorpay-backdrop");a.length>0?(console.log("changing background of razorpay-backdrop"),a[0].style.background="lightgray"):setTimeout(c,100)};c()}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.SupportPage=Backbone.NativeView.extend({initialize:function(){if(this.origin=Plugin.app.configMgr.getConfigVal("contentUrl"),this.amount=Number(Plugin.app.parsedParams.supportPage.amount),this.amount<=0)return console.log("invalid amount"),void window.parent.postMessage({status:"failure",error:"invalid amount"},this.origin);if(this.supporterName=Plugin.app.parsedParams.supportPage.supporterName||"",this.supporterName=this.supporterName.trim(),!this.supporterName)return console.log("need a name"),void window.parent.postMessage({status:"failure",error:"need a name"},this.origin);if(this.email=Plugin.app.parsedParams.supportPage.email||"",this.email=this.email.trim(),!this.email)return console.log("need an email"),void window.parent.postMessage({status:"failure",error:"need an email"},this.origin);if(this.phone=Plugin.app.parsedParams.supportPage.phone||"",this.phone=this.phone.trim(),!this.phone)return console.log("need a phone"),void window.parent.postMessage({status:"failure",error:"need a phone"},this.origin);switch(Plugin.app.subconfigName="SupportPage",this.frequency=Plugin.app.parsedParams.supportPage.frequency,"s"===this.frequency&&(this.frequency="single"),"m"===this.frequency&&(this.frequency="monthly"),"y"===this.frequency&&(this.frequency="yearly"),this.frequency){case"single":this.singlePayment();break;case"monthly":case"yearly":this.spellItOut();break;default:console.log("invalid frequency provided"),window.parent.postMessage({status:"failure",error:"invalid frequency"},this.origin)}},events:{"click .proceed":"subscribe","click .cancel":"cancelPayment"},spellItOut:function(){var a="ONE MONTH";"yearly"===this.frequency&&(a="ONE YEAR"),this.el.innerHTML=JST["app/scripts/templates/Standard/SubscriptionConfirmation.ejs"].apply({fontFamily:Plugin.app.configMgr.getConfigVal("fontFamily"),duration:a,logoUrl:Plugin.app.configMgr.getConfigVal("logoUrl"),bgColor:Plugin.app.configMgr.getConfigVal("theme-secondary")})},cancelPayment:function(a){window.parent.postMessage({status:"failure",error:"user changed mind"},this.origin)},showSuccessMessage:function(){},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},singlePayment:function(){var a=this;Plugin.app.payments.payWithRazorpay_Spot({button_amount:this.amount,amount_to_pay:this.amount,payment_type:"instant",supporterName:this.supporterName,email:this.email,phone:this.phone,callbacks:{onsuccess:function(b){a.showSuccessMessage(),window.parent.postMessage({status:"success",response:b,ptype:"single"},a.origin)},ondismiss:function(){window.parent.postMessage({status:"failure",error:"user closed window"},a.origin)}}});var b=function(){var a=document.getElementsByClassName("razorpay-backdrop");a.length>0?(console.log("changing background of razorpay-backdrop"),a[0].style.background="lightgray"):setTimeout(b,100)};b()},subscribe:function(){var a=this;Plugin.app.payments.payWithRazorpay_SubMerchantAccountSubscription({plan_amount:this.amount,subscription_type:this.frequency,supporterName:this.supporterName,email:this.email,phone:this.phone,callbacks:{onerror:function(b){console.log(b),window.parent.postMessage({status:"failure",error:"error",details:b},a.origin)},ondismiss:function(){window.parent.postMessage({status:"failure",error:"user closed window"},a.origin)},onsuccess:function(b){a.showSuccessMessage(),window.parent.postMessage({status:"success",response:b,ptype:"subscription"},a.origin)}}});var b=function(){var a=document.getElementsByClassName("razorpay-backdrop");a.length>0?(console.log("changing background of razorpay-backdrop"),a[0].style.background="lightgray"):setTimeout(b,100)};b()}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.AllInOne=Backbone.NativeView.extend({cfg:function(a){return Plugin.app.configMgr.getConfigVal(a)},strval:function(a){return Plugin.app.configMgr.getStringVal(a)},RAND_INT:function(a){return Math.floor(Math.random()*Math.floor(a))},initialize:function(){this.listenTo(Plugin.app.unpaid,"add",this.render),this.listenTo(Plugin.app.unpaid,"remove",this.render),this.listenTo(Plugin.app.unpaid,"change",this.render);var a=this.cfg("messages");a||(a=[{lines:[{text:""}]}]),this.messageIdx=this.RAND_INT(a.length),this.messageToShow=a[this.messageIdx],this.buttons=this.cfg("buttons")||{config:{}},this.runPoll=!1,this.poll=null;var b=this.cfg("polls");if(b)for(var c=(new Date).valueOf(),d=0;d<b.length;++d){var e=b[d];if(e.start<=c&&c<=e.end){this.runPoll=!0,this.poll=e;break}}if(this.learnMore=this.cfg("learnMore"),this.learnMoreIdx=0,this.royalty=new Backbone.Model({to:Plugin.app.parsedParams.ownerid,toName:encodeURIComponent(this.cfg("showName")||this.cfg("ownerName")),url:Plugin.app.parsedParams.content_url,amt:0,dm:(new Date).valueOf(),midx:this.messageIdx}),this.calcPublisherTotals(),this.userphone=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:userphone")||null,this.useremail=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:useremail")||null,this.usermethod=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:usermethod")||"card",this.userpansubmitted=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:userpansubmitted")||!1,this.feeStruct={},this.payment_type=null,this.show={},this._set_all_false(),this.show.cta=!0,this.runPoll){var f=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:poll-")+this.poll.name||null;if(f){var g=this;setTimeout(function(){var a=new AWS.Lambda({region:"ap-south-1"});a.invoke({FunctionName:"PollResults",Payload:JSON.stringify({pollName:g.poll.name,action:"get-results"})},function(a,b){g.parsePollResults(a,b)})},500)}else this._set_all_false(),this.show.pollQuestions=!0}this.currentUDAmtIdx=0,this.listenTo(this.royalty,"change",this.render),this.updateCart()},_set_all_false:function(){this.show.cta=!1,this.show.edit_royalty=!1,this.show.user_info=!1,this.show.ask_monthly=!1,this.show.learn_more=!1,this.show.thank_you=!1,this.show.pollQuestions=!1,this.show.pollResults=!1,this.show.youtubeplaylist=!1,this.show.invoice=!1,this.show.nologo=!1,this.show.maybesubscribe=!1,this.show.try_razorpay=!1},events:{"click .add-to-cart":"addToCart","click .open-dashboard":"openDashboard","click .incr":"incr","click .decr":"decr","click .cancel-royalty":"cancelRoyalty","click .clear-from-cart":"clearFromCart","click .close-dashboard":"closeDashboard","click .get-user-info":"getUserInfo","click .save-user-info":"saveUserInfo","click .select-method":"selectMethod","click .toggle-monthly":"toggleMonthly","click .set-amount":"setAmount","click .pay-unpaid":"payUnpaid","click .insta-pay":"instaPay","click .set-amt-and-pay":"setAmountAndPay","click .really-pay":"doPayment","click .init-pay":"initPayment","click .close-after-payment":"closeAfterPayment","click .poll-after-payment":"pollAfterPayment","click .ud-up":"incrUDAmt","click .ud-down":"decrUDAmt","click .whats-this":"whatsThis","click .poll-response":"pollResponse","click .poll-submit":"pollSubmit","click .show-invoice":"showInvoice","click .show-youtubeplaylist":"showYouTubePlaylist","click .pay-custom":"payAmount","click .pay-with-razorpay":"tryAgain"},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},calcBaseAmount:function(){var a=this.royalty.get("amt");return Plugin.app.unpaid.forEach(function(b){b.get("to")===Plugin.app.parsedParams.ownerid&&(a+=b.get("amt"))}),a},render:function(){this.calcPublisherTotals(),("shopping-cart"===this.payment_type||null===this.payment_type)&&(this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount()));var a=window.innerWidth<450;"samachara"===Plugin.app.parsedParams.ownerid&&(a=window.innerWidth<800);var b=this.cfg("orientation");a&&(b="portrait"),this.show.edit_royalty&&(b="portrait");var c=!!this.cfg("hideLogoPortrait"),d=!!this.cfg("hideLogoLandscape"),e=this.cfg("theme-primary"),f=this.cfg("theme-secondary"),g=f,h=e,i=g,j=g,k=this.cfg("btnBrdrWth"),l="",m="1px solid lightgray",n="black",o=this.cfg("borderDef"),p="grey",q=null,r=g,s=g,t="comp.cta.landscape",u="comp.cta.portrait",v=this.cfg("uxTheme"),w=this.strval("pgFeesExtra"),x=null,y=this.cfg("colorTheme");if("theme-1"===y){var z=e,A=f;g=A,h=z,i=A,j=A,k="1px",r=A}if("theme-2"===y){var z=e,A=f;g=A,h=z,i=A,j=A,k="1px",m="2px solid "+A,n=A,o="border: 2px solid "+A+"; border-radius: 3px;",p=A,q=z,r=A,s=z}if("theme-3"===y){var z=e,A=f;g=A,h=z,i=A,j=A,k="1px",q=z,r=z}var B="padding: 5px;";B+="text-align: center;",B+=a?"font-size: 12px;":"font-size: 18px;",B+="cursor: pointer;",B+="border-style: solid; ",B+="border-radius: 3px;",B+="max-width: 150px;",B+="margin-left: 10px; margin-right: 10px;",B+="width: 20%;",B+="display: flex;",B+="flex-direction: column;",B+="justify-content: center;",B+="align-items: center;",B+="color: "+h+"; ",B+="background-color: "+i+"; ",B+="border-color: "+j+"; ",B+="border-width: "+k+"; ";var C="padding: 5px;";C+="text-align: center;",C+=a?"font-size: 12px;":"font-size: 18px;",C+="cursor: pointer;",C+="border-style: solid; ",C+="border-radius: 3px;",C+="color: "+h+"; ",C+="background-color: "+i+"; ",C+="border-color: "+j+"; ",C+="border-width: "+k+"; ";var D="padding: 5px;";D+="text-align: center;",D+="font-size: 18px;",D+="cursor: pointer;",D+="margin: 0px auto;",D+="color: grey;","cta-no-border"===v&&(t="comp.cta.noborder",u="comp.cta.noborder",d=!0,c=!0,o="",w=""),"cta-no-border-with-a-pic"===v&&(t="comp.cta.noborderwithapic",u="comp.cta.noborderwithapic",d=!0,c=!0,o="",w="",x="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRJRHSJ54u0qnr9FFcXiHT3P0_DKDjlfM5wGAU6fbxaLHteiO-F"),"cta-fixed-plus-custom"===v&&(t="comp.cta.fixedpluscustom.landscape",u="comp.cta.fixedpluscustom.portrait");var E={ui:{fontFamily:this.cfg("fontFamily"),fontWt:this.cfg("fontWt"),uxBorderDef:o,outerPadding:this.cfg("outerPadding"),gearColor:p,cta_text_color:n,pgExtraMT:this.cfg("pgExtraMT")||"20"},data:{orientation:b,show:this.show,royalty:this.royalty.toJSON(),increment:Number(this.buttons.config.increment),ptotals:this.ptotals,feeStruct:this.feeStruct,learnMoreMsg:this.learnMore[this.learnMoreIdx],hideLogoLandscape:d,hideLogoPortrait:c},strings:{pgFeesExtra:w},templates:{}},F=function(a){return JST["app/scripts/templates/Standard/"+a+".ejs"]};if("portrait"!==b||c||(E.templates.portraitLogo=F("comp.logo.portrait").apply({ui:{headerHt:this.cfg("headerHt"),headerImgHt:this.cfg("headerImgHt"),headerBrdDef:l,logo_background_color:r,link_background_color:s,link_text_color:n,imgBg:q},data:{logoUrl:this.cfg("logoUrl")},strings:{partnerLink:this.strval("partnerLink")}})),"landscape"===b&&this.show.cta&&(d||(E.templates.landscapeLogo=F("comp.logo.landscape").apply({ui:{logo_background_color:r,leftImgHt:this.cfg("leftImgHt"),imgBg:q,containerHt:this.cfg("containerHt")},data:{logoUrl:this.cfg("logoUrl")}})),E.templates.landscapeCTA=F(t).apply({ui:{style_action_btn:B,style_subtle_btn:D,cta_text_color:n,solid_color:g,cta_hr_mt:this.cfg("cta_hr_mt"),cta_hr_def:m,cta_tnc_mrt:this.cfg("cta_tnc_mrt"),msgLineHeight:this.cfg("cta_left_lh"),fontWt:this.cfg("fontWt"),fontSize:this.cfg("leftCTAFtSz"),gearColor:p,style_action_btn_withapic:C,imgUrl:x,noborder_ff_btns:this.cfg("noborder.buttons.fontfamily")},data:{messageToShow:this.messageToShow,cta_show_cart:this.ptotals.length>0||this.royalty.get("amt")>0,increment:Number(this.buttons.config.increment),amounts:this.buttons.config.amounts,incrementText:this.buttons.config.incrementText,amountsText:this.buttons.config.amountsText,subscriptions:this.cfg("subscriptions")},strings:{rupeeSymbol:this.strval("rupeeSymbol"),pgFeesExtra:this.strval("pgFeesExtra")}})),"portrait"===b&&this.show.cta&&(E.templates.portraitCTA=F(u).apply({ui:{style_action_btn:B,style_subtle_btn:D,updown_stroke:e,updown_fill:g,solid_color:g,fontWt:this.cfg("fontWt"),fontSize:this.cfg("headerCTAFtSz"),cta_text_color:n,ctaMarginTop:this.cfg("ctaMarginTop"),ctaMarginBottom:this.cfg("ctaMarginBottom"),style_action_btn_withapic:C,imgUrl:x,noborder_ff_btns:this.cfg("noborder.buttons.fontfamily")},data:{messageToShow:this.messageToShow,cta_show_cart:this.ptotals.length>0||this.royalty.get("amt")>0,increment:Number(this.buttons.config.increment),incrementText:this.buttons.config.incrementText,amounts:this.buttons.config.amountsRow1||this.buttons.config.amounts,amountsRow2:this.buttons.config.amountsRow2,amountsRow2Text:this.buttons.config.amountsRow2Text,amountsText:this.buttons.config.amountsText,upDownAmounts:this.buttons.config.upDownAmounts,currentUDAmtIdx:this.currentUDAmtIdx,subscriptions:this.cfg("subscriptions")},strings:{rupeeSymbol:this.strval("rupeeSymbol"),pgFeesExtra:this.strval("pgFeesExtra")}})),this.show.try_razorpay&&(E.templates.tryAgain=F("comp.tryagain").apply({ui:{style_action_btn:B,button_fill:f},data:{feeStruct:this.feeStruct},strings:{rupeeSymbol:this.strval("rupeeSymbol")}})),this.show.thank_you&&(E.templates.thankYou=F("comp.thankyou").apply({ui:{button_text_color:e,button_fill:f},data:{payment_id:this.payment_id,payment_type:this.payment_type,subscriptionType:this.subscriptionType,feeStruct:this.feeStruct,ownerName:this.cfg("ownerName")},strings:{thankYou:this.strval("thankYou")}})),this.show.invoice&&(E.templates.invoice=F("comp.invoice").apply({ui:{button_text_color:e,button_fill:f},data:{payment_id:this.payment_id,payment_type:this.payment_type,subscriptionType:this.subscriptionType,feeStruct:this.feeStruct,ownerName:this.cfg("ownerName")},strings:{thankYou:this.strval("thankYou")}})),this.show.youtubeplaylist){var G=this.cfg("ytplaylists");if(G.length>0){var H=this.RAND_INT(G.length),I=G[H];E.templates.youtubePlaylist=F("comp.youtubeplaylist").apply({ui:{button_text_color:e,button_fill:f},data:{playListUrl:I.playListUrl,playListTitle:I.playListTitle,playListImgUrl:I.playListImgUrl},strings:{thankYou:this.strval("thankYou")}})}else this.show.youtubeplaylist=!1}if(this.show.pollQuestions&&this.poll&&(E.templates.portraitPollQ=F("comp.poll.questions.portrait").apply({ui:{style_action_btn:B,style_subtle_btn:D},data:{poll:this.poll},strings:{}})),this.show.pollResults&&this.poll&&(E.templates.portraitPollR=F("comp.poll.results.portrait").apply({data:{poll:this.poll,pollResults:this.pollResults}})),"landscape"===b&&(E.templates.landscapeActions=F("comp.actionsrow.landscape").apply({ui:{cta_text_color:n,gearColor:p},data:{feeStruct:this.feeStruct},strings:{pgFeesExtra:this.strval("pgFeesExtra"),rupeeSymbol:this.strval("rupeeSymbol")}})),"portrait"===b&&(E.templates.portraitActions=F("comp.actionsrow.portrait").apply({ui:{cta_text_color:n,gearColor:p},data:{feeStruct:this.feeStruct},strings:{rupeeSymbol:this.strval("rupeeSymbol")}})),this.show.user_info&&(E.templates.userInfo=F("comp.userinfo").apply({ui:{style_action_btn:B,style_subtle_btn:D,fontFamily:this.cfg("fontFamily"),fontWt:this.cfg("fontWt"),underlinecolor:g},data:{userphone:this.userphone,useremail:this.useremail,usermethod:this.usermethod}})),this.show.maybesubscribe&&(E.templates.maybeSubscribe=F("comp.subscription.kyc").apply({ui:{text_color:g,underline_color:g,checkmark_stroke_color:g,style_action_btn:B,style_subtle_btn:D},data:{feeStruct:this.feeStruct,need_pan:this.doWeNeedPAN()&&!this.userpan&&!this.userpansubmitted,payment_type:this.payment_type,subscriptionType:this.subscriptionType,editing_amount:this.editing_amount},strings:{monthly:this.strval("monthly"),annual:this.strval("annual"),oneTime:this.strval("oneTime"),autodebit:this.strval("autodebit")}})),this.show.ask_monthly&&(E.templates.askMonthly=F("comp.askmonthly").apply({ui:{underline_color:g,checkmark_stroke_color:g,style_action_btn:B,style_subtle_btn:D},data:{payment_type:this.payment_type,feeStruct:this.feeStruct},strings:{cancel:this.strval("cancel"),rupeeSymbol:this.strval("rupeeSymbol")}})),this.show.edit_royalty&&this.ptotals.length>0&&(E.templates.publisherTotals=F("comp.publishertotals").apply({data:{ptotals:this.ptotals},strings:{pending:this.strval("pending"),rupeeSymbol:this.strval("rupeeSymbol")}})),this.show.edit_royalty&&(E.templates.payNowPayLater=F("comp.paynowpaylater").apply({ui:{button_text_color:h,style_action_btn:B,style_subtle_btn:D},data:{feeStruct:this.feeStruct},strings:{saveForLater:this.strval("saveForLater"),close:this.strval("close"),rupeeSymbol:this.strval("rupeeSymbol"),pgCosts:this.strval("pgCosts")}})),this.show.edit_royalty&&(E.templates.thisRoyalty=F("comp.thisroyalty").apply({ui:{plusminus_bg:f,plusminus_fg:e},data:{royalty:this.royalty.toJSON()},strings:{rupeeSymbol:this.strval("rupeeSymbol"),forThisArticle:this.strval("forThisArticle")}})),this.el.innerHTML=F("ux.allinone").apply(E),setTimeout(function(){Plugin.app.requestPositioning()},200),!this.editing_amount){var J=this,K=document.getElementById("amount-input");K&&K.addEventListener("focus",function(a){J.editing_amount=!0,J.render();var b=document.getElementById("amount-input");b.focus(),b.selectionStart=b.selectionEnd=b.value.length})}var K=document.getElementById("amount-input");if(K){var J=this;K.addEventListener("change",function(a){J.setAmount(a)})}},tryAgain:function(a){this.payWithRazorpay_Spot(a)},payAmount:function(a){var b=document.getElementById("custom-amt"),c=Number(b.value);return 5>c||c>5e3?void(b.value=""):(this.payment_type="instant",this.subscriptionType=null,this.feeStruct=Plugin.app.payments.addFees(c),void(0!==this.feeStruct.base_amount&&this.doPayment(a)))},setAmount:function(a){a.preventDefault();var b=document.getElementById("amount-input");if(""===b.value)return this.editing_amount=!1,void this.render();var c=Number(b.value),d=1e4;this.cfg("submerchant_key")&&(d=15e4),c>0&&d>c?("shopping-cart"===this.payment_type?(this.royalty.set({amt:c}),this.feeStruct=Plugin.app.payments.addFees(c)):"once"===this.subscriptionType?this.feeStruct=Plugin.app.payments.addFees(c):this.feeStruct={base_amount:c,fees:0,amount_to_pay:c,button_amount:c},this.editing_amount=!1,this.render()):(b.value="",b.focus())},incrUDAmt:function(a){this.currentUDAmtIdx=Math.min(this.buttons.config.upDownAmounts.length-1,this.currentUDAmtIdx+1);var b=document.getElementById("ud-insta-pay"),c=String(this.buttons.config.upDownAmounts[this.currentUDAmtIdx]);b.innerHTML="₹"+c,b.setAttribute("data-amt",c)},decrUDAmt:function(a){this.currentUDAmtIdx=Math.max(0,this.currentUDAmtIdx-1);var b=document.getElementById("ud-insta-pay"),c=String(this.buttons.config.upDownAmounts[this.currentUDAmtIdx]);b.innerHTML="₹"+c,b.setAttribute("data-amt",c)},pollResponse:function(a){a.preventDefault();var b=a.delegateTarget||a.currentTarget||a.target,c=Number(b.getAttribute("data-response"));this.poll.currentAnswerIdx=c,this.render()},pollSubmit:function(a){if(a.preventDefault(),this.poll.hasOwnProperty("currentAnswerIdx")){console.log("submitting answer "+String(this.poll.currentAnswerIdx)),Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:poll-"+this.poll.name,String(this.poll.currentAnswerIdx));var b=new AWS.Lambda({region:"ap-south-1"}),c=this,d={pollName:c.poll.name,action:"submit",response:c.poll.answers[c.poll.currentAnswerIdx].text};b.invoke({FunctionName:"PollResults",Payload:JSON.stringify(d)},function(a,b){c.parsePollResults(a,b)}),this._set_all_false(),this.show.pollResults=!0,this.show.cta=!0,this.render()}},parsePollResults:function(a,b){if(this.pollResults={},a)console.log(a);else{for(var c=JSON.parse(b.Payload),d=0;d<this.poll.answers.length;++d)this.pollResults[this.poll.answers[d].text]=0;for(var e in c)this.pollResults[e]=c[e]}this._set_all_false(),this.show.cta=!0,this.show.pollResults=!0,this.render()},showInvoice:function(a){this._set_all_false(),this.show.invoice=!0,this.show.nologo=!0,this.render()},showYouTubePlaylist:function(a){this._set_all_false(),this.show.youtubeplaylist=!0,this.show.nologo=!0,this.render()},whatsThis:function(a){this.show.learn_more?(this.learnMoreIdx++,this.learnMoreIdx>=this.learnMore.length?(this.show.learn_more=!1,this.learnMoreIdx=0,this.render()):document.getElementById("learn-more").innerHTML=this.learnMore[this.learnMoreIdx]):(this.show.learn_more=!0,this.learnMoreIdx=0,this.render())},incr:function(a,b){var c=this.royalty.get("amt"),d=Number(this.buttons.config.increment)||10;if(c+=d,1e3>=c)if(this.royalty.set({amt:c,dm:(new Date).valueOf()},{silent:!0}),b&&"add-to-cart"===b.from&&this.show.edit_royalty)this.render();else if(b&&"add-to-cart"===b.from&&this.show.cta)Plugin.app.storage.addEventToQ(this.royalty.toJSON()),this.updateCart();else if(c===d)this.render();else{var e=this.cfg("rupeeSymbol");document.getElementById("this-royalty-amt").innerHTML=e+String(c),this.calcPublisherTotals(),this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount()),document.getElementById("pg-costs").innerHTML="<i>* PG COSTS: "+e+String(this.feeStruct.fees.toFixed(2))+"</i>",document.getElementById("really-pay-amt").innerHTML=e+String(this.feeStruct.amount_to_pay.toFixed(2)),document.getElementById("this-article-amt")&&(document.getElementById("this-article-amt").innerHTML=e+String(this.royalty.get("amt")))}},decr:function(a){if(0===this.feeStruct.amount_to_pay)this.closeDashboard();else{var b=Number(this.buttons.config.increment)||10,c=this.royalty.get("amt");if(c=Math.max(0,c-b),this.royalty.set({amt:c,dm:(new Date).valueOf()},{silent:!0}),c>0){var d=this.cfg("rupeeSymbol");document.getElementById("this-royalty-amt").innerHTML=d+String(c),this.calcPublisherTotals(),this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount()),document.getElementById("pg-costs").innerHTML="<i>* PG COSTS: "+d+String(this.feeStruct.fees.toFixed(2))+"</i>",document.getElementById("really-pay-amt").innerHTML=d+String(this.feeStruct.amount_to_pay.toFixed(2)),document.getElementById("this-article-amt")&&(document.getElementById("this-article-amt").innerHTML=d+String(this.royalty.get("amt")))}else this.render()}},cancelRoyalty:function(a){0===this.royalty.get("amt")&&0===this.ptotals.length?this.closeDashboard():this.royalty.set("amt",0)},clearFromCart:function(a){for(var b=a.delegateTarget||a.currentTarget||a.target,c=Number(b.getAttribute("data-idx")),d=this.ptotals[c].pubid,e=Plugin.app.unpaid.toJSON(),f=0,c=0;c<e.length;c++){var g=e[c];g.to===d&&(f+=g.amt,g.amt=0,Plugin.app.storage.addEventToQ(g))}this.updateCart(),this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount())},calcPublisherTotals:function(){for(var a={},b={},c=Plugin.app.unpaid.toJSON(),d=0;d<c.length;d++){var e=c[d].to;a.hasOwnProperty(e)||(a[e]=0),a[e]+=c[d].amt,b[e]=c[d].toName&&decodeURIComponent(c[d].toName)||e}this.ptotals=[];for(var e in a)this.ptotals.push({pubid:e,pubname:b[e],amt:a[e]})},openDashboard:function(a){this._set_all_false(),this.show.edit_royalty=!0,this.payment_type="shopping-cart",this.render()},payUnpaid:function(a){this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount()),0!==this.feeStruct.base_amount&&(this.payment_type="shopping-cart",this.doPayment())},addToCart:function(a){a.preventDefault(),this.payment_type="shopping-cart",this.incr(a,{from:"add-to-cart"})},_reset:function(){this._set_all_false(),this.show.cta=!0,this.payment_type=null,this.subscriptionType=null,this.alreadySetAmt=!1},closeDashboard:function(a){if(!this.alreadySetAmt){this.payment_type;this._reset(),Plugin.app.storage.addEventToQ(this.royalty.toJSON()),this.updateCart(),this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount())}},getUserInfo:function(a){this.savedShow?(this.show=JSON.parse(JSON.stringify(this.savedShow)),this.savedShow=null):(this.savedShow=JSON.parse(JSON.stringify(this.show)),this._set_all_false(),this.show.user_info=!0),this.render()},saveUserInfo:function(a){var b=document.getElementById("input-phone"),c=document.getElementById("input-email");if(b.value.trim()){var d=b.value.trim();Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:userphone",d),this.userphone!==d&&(this.userphone=d,Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.removeItem("orcsnet:userpansubmitted"),this.userpan=null)}if(c.value.trim()){var e=c.value.trim();Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:useremail",e),this.useremail!==e&&(this.useremail=e,Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.removeItem("orcsnet:userpansubmitted"),
this.userpan=null)}this.savedShow?(this.show=JSON.parse(JSON.stringify(this.savedShow)),this.savedShow=null):this._reset(),this.render()},selectMethod:function(a){a.preventDefault();var b=a.delegateTarget||a.currentTarget||a.target;this.usermethod=b.getAttribute("data-method"),this.usermethod&&Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:usermethod",this.usermethod);var c=document.getElementById("input-phone"),d=document.getElementById("input-email"),e=c.value.trim()||this.userphone,f=d.value.trim()||this.useremail;e&&Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:userphone",e),f&&Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:useremail",f),this.userphone=e,this.useremail=f,this.render()},instaPay:function(a){a.preventDefault();var b=a.delegateTarget||a.currentTarget||a.target,c=Number(b.getAttribute("data-amt")),d=b.getAttribute("data-subscription")&&"yes"===b.getAttribute("data-subscription");0!==c&&(d&&"the-wire"===Plugin.app.parsedParams.ownerid?(this.payment_type="subscription",this.subscriptionType="monthly",this.feeStruct={base_amount:c,fees:0,amount_to_pay:c,button_amount:c}):(this.payment_type="instant",this.subscriptionType=null,this.feeStruct=Plugin.app.payments.addFees(Number(c))),0!==this.feeStruct.base_amount&&this.doPayment(a))},doWeNeedPAN:function(){return this.feeStruct.button_amount<1e3?!1:!!this.cfg("needPAN")},_isValidPan:function(a){if(!a)return!1;if(a=a.toUpperCase().replace(/ /g,""),10!==a.length)return!1;var b=a.substring(0,3),c=a.substring(3,4),d=a.substring(4,5),e=a.substring(5,9),f=a.substring(9,10),g=b&&b.match(/[A-Z]+/);if(!g)return!1;var g=c&&c.match(/[CPHFATBLJG]/);if(!g)return!1;var g=d&&d.match(/[A-Z]/);if(!g)return!1;var g=e&&e.match(/[0-9]+/);if(!g)return!1;var g=f&&f.match(/[A-Z]/);return g?!0:!1},_has_user_info:function(){return!!(this.useremail&&this.userphone&&this.usermethod)},setAmountAndPay:function(a){var b=document.getElementById("amount-input"),c=b.value;if(""!==c){var d=Number(c);if(10>d||d>15e4)return b.value="",void b.focus();this.feeStruct=Plugin.app.payments.addFees(d),this.alreadySetAmt=!0;var e=a.delegateTarget||a.currentTarget||a.target,f=e.getAttribute("data-type");"monthly"===f?(this.payment_type="subscription",this.subscriptionType="monthly"):"yearly"===f?(this.payment_type="subscription",this.subscriptionType="yearly"):(this.payment_type="instant",this.subscriptionType="once"),this.doPayment()}},doPayment:function(a){if(this.show.maybesubscribe===!1&&this.doWeNeedPAN())this._set_all_false(),this.show.maybesubscribe=!0,this.render();else if(this.show.maybesubscribe===!1&&this.cfg("subscriptions")&&"the-wire"===Plugin.app.parsedParams.ownerid)this._set_all_false(),this.show.maybesubscribe=!0,this.render();else if(this.show.maybesubscribe){if(!this.userpansubmitted){var b=document.getElementById("input-pan");if(b){var c=b.value.trim();if(!c||!this._isValidPan(c)){var d={"PAN number":"=> PAN number","Invalid PAN":"=> PAN number","=> PAN number":"=> PAN NUMBER! <=","=> PAN NUMBER! <=":"PAN number"};return b.value="",b.style.borderColor=this.cfg("themeColor"),c?b.placeholder="Invalid PAN":b.placeholder=d[b.placeholder],void(this.alreadySetAmt=!1)}this.userpan=c.toUpperCase().replace(/ /g,"")}}this.initPayment(a)}else this.cfg("askMonthly")?(this._set_all_false(),this.show.ask_monthly=!0,this.render()):(this._set_all_false(),this.initPayment(a))},toggleMonthly:function(a){var b=this.feeStruct.button_amount;switch(this.payment_type){case"instant":this.payment_type="subscription",this.subscriptionType="monthly",this.feeStruct={base_amount:b,fees:0,amount_to_pay:b,button_amount:b};break;case"subscription":this.payment_type="instant",this.subscriptionType=null,this.feeStruct=Plugin.app.payments.addFees(Number(b))}this.render()},initPayment:function(a){"paytm"===this.cfg("payment_gateway")?this.payWithPayTMSpot(a):this.cfg("submerchant_key")&&"subscription"===this.payment_type?this.payWithRazorpay_SubMerchantAccountSubscription(a):this.payWithRazorpay_Spot(a)},payWithPayTMSpot:function(a){var b=this;Plugin.app.payments.payWithPayTMSpot({button_amount:this.feeStruct.button_amount,amount_to_pay:this.feeStruct.amount_to_pay,payment_type:this.payment_type,callbacks:{success:function(a){Plugin.log(a),b.afterPayment(a)},paytmfail:function(a){Plugin.log(a),Plugin.app.sendEvent_v2({action:"paytm-payment-failed",response_code:a}),b._set_all_false(),b.show.try_razorpay=!0,b.render()},otherfail:function(){Plugin.log("otherfail"),Plugin.app.sendEvent_v2({action:"paytm-payment-lambda-failed"}),b._set_all_false(),b.show.try_razorpay=!0,b.render()}}})},payWithRazorpay_Spot:function(a){Plugin.app.payments.payWithRazorpay_Spot({payment_type:this.payment_type,button_amount:this.feeStruct.button_amount,amount_to_pay:this.feeStruct.amount_to_pay,callbacks:{ondismiss:this.cancelPayment.bind(this),onsuccess:this.afterPayment.bind(this)},usermethod:this.usermethod,userpan:this.userpan})},payWithRazorpay_SubMerchantAccountSubscription:function(a){for(var b=document.getElementsByClassName("set-amt-and-pay"),c=0;c<b.length;c++){var d=b[c];d&&(d.innerHTML="...",d.style["background-color"]="rgb(202, 76, 78)",d.style["border-color"]="rgb(202, 76, 78)")}var e=document.getElementById("amount-input");e&&(e.disabled=!0,e.readOnly=!0);for(var f=document.getElementsByClassName("init-pay"),g=0;g<f.length;g++){var h=f[g];h&&(h.innerHTML="...",h.style["background-color"]="rgb(43, 85, 152)",h.style["border-color"]="rgb(43, 85, 152)"),this.alreadySetAmt=!0}Plugin.app.payments.payWithRazorpay_SubMerchantAccountSubscription({plan_amount:this.feeStruct.button_amount,subscription_type:this.subscriptionType||"monthly",callbacks:{ondismiss:this.cancelPayment.bind(this),onsuccess:this.afterPayment.bind(this),onerror:this.cancelPayment.bind(this)},userpan:this.userpan})},cancelPayment:function(){this._reset(),this.render()},afterPayment:function(a){Plugin.app.storage.flushQ(),this._set_all_false(),this.payment_id=a,"youtubeplaylist"===this.cfg("afterPayment")?this.showYouTubePlaylist():(this.show.thank_you=!0,this.payment_type="instant",this.updateCart())},closeAfterPayment:function(a){Plugin.app.backToFront()},pollAfterPayment:function(a){var b=a.delegateTarget||a.currentTarget||a.target;b.getAttribute("data-response")||"no";this.show.responded=!0,this.render()},updateCart:function(){Plugin.app.unpaid.reset(Plugin.app.storage.getCurrentState());var a=Plugin.app.unpaid.findIndex({url:this.royalty.get("url")});if(a>-1){var b=Plugin.app.unpaid.at(a);this.royalty.set(b.toJSON(),{silent:!0}),Plugin.app.unpaid.remove(b)}else this.royalty.set({amt:0},{silent:!0});this.render()}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.Uxv2=Backbone.NativeView.extend({RAND_INT:function(a){return Math.floor(Math.random()*Math.floor(a))},getStringPack:function(){var a={};for(var b in Plugin.app.configMgr.stringPack)a[b]=Plugin.app.configMgr.getStringVal(b);return a},initialize:function(){var a=window.innerWidth<450;"samachara"===Plugin.app.parsedParams.ownerid&&(a=window.innerWidth<800),this.orientation="landscape",a&&(this.orientation="portrait_small",Plugin.app.configMgr.getConfigVal("uxv2.orientation-on-mobile")&&(this.orientation=Plugin.app.configMgr.getConfigVal("uxv2.orientation-on-mobile"))),Plugin.app.configMgr.getConfigVal("uxv2.orientation")&&(this.orientation=Plugin.app.configMgr.getConfigVal("uxv2.orientation")),"portrait_tall"===Plugin.app.parsedParams.orientation&&(this.orientation="portrait_tall"),"portrait_small"===Plugin.app.parsedParams.orientation&&(this.orientation="portrait_small");var b=Plugin.app.parsedParams.flowName||Plugin.app.configMgr.getConfigVal("flowName");if(this.flow=Plugin.app.configMgr.getUxv2Flow(b),Plugin.app.configMgr.getConfigVal("uxv2.ptall.topbg"))for(var c in this.flow.transitions)this.flow.transitions[c].ui=this.flow.transitions[c].ui||{},this.flow.transitions[c].ui.ptall_topbg="background-color: "+Plugin.app.configMgr.getConfigVal("uxv2.ptall.topbg")+";",this.flow.transitions[c].ui.ptall_topbg+="margin-bottom: 20px; ";if(Plugin.app.configMgr.getConfigVal("uxv2.ptall.logoht"))for(var c in this.flow.transitions)this.flow.transitions[c].ui=this.flow.transitions[c].ui||{},this.flow.transitions[c].ui.ptall_logoht="height: "+Plugin.app.configMgr.getConfigVal("uxv2.ptall.logoht")+";";if(this.tmpl_dir="UXv2",Plugin.app.configMgr.getConfigVal("uxv2.templatelocation")&&(this.tmpl_dir=Plugin.app.configMgr.getConfigVal("uxv2.templatelocation")),this.state={rot:1,assetHt:"100",logoUrl:Plugin.app.configMgr.getConfigVal("logoUrl"),showAnnual:!!Plugin.app.configMgr.getConfigVal("uxv2.showannual"),strings:this.getStringPack(),ui:{},amount:null,amounts:[50,100,500],currency:Plugin.app.configMgr.currencyConfig.INR,ptype:"instant",feeStruct:{},cta:"Support our work",cta1:"Support our work",international:Plugin.app.configMgr.getConfigVal("international"),subscriptions:Plugin.app.configMgr.getConfigVal("subscriptions"),vsubscriptions:Plugin.app.configMgr.getConfigVal("vsubscriptions")},Plugin.app.parsedParams.amount&&(this.state.amount=Plugin.app.parsedParams.amount),"follow-up-2019-04"!==Plugin.app.parsedParams.channel||this.state.amount||(this.state.amount=200),this.state.vsubscriptions?this.state.supportPlan="vsubscriptions":this.state.subscriptions&&(this.state.supportPlan="subscriptions"),Plugin.app.parsedParams.name&&(this.state.supporterName=Plugin.app.parsedParams.name),Plugin.app.configMgr.getConfigVal("uxv2.startingamount")?this.state.amount=Number(Plugin.app.configMgr.getConfigVal("uxv2.startingamount")):this.setRotStart(),this.screen=this.flow.start,"p_vsub_1"===this.screen&&(this.state.ptype=null),"p_sub_vsub_cta"===this.screen&&(this.state.subscriptions||this.state.vsubscriptions)&&(this.state.ptype=null),Plugin.app.configMgr.getConfigVal("poll")){var d=Plugin.app.configMgr.getConfigVal("poll");this.pollName=d.pollName,this.screen="p_pollq",this.orientation="landscape",Plugin.app.storage.localStorageAvailable&&(this.state.polla=localStorage.getItem("orcsnet:poll:"+this.pollName))}},setRotStart:function(){var a=this.flow.transitions.p_amtselection&&this.flow.transitions.p_amtselection.rot_start;null!==a&&void 0!==a&&(this.state.rot=["lo","mid","hi"].indexOf(a))},events:{"click .c_ctrl":"clickHandler"},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},t:function(a){return JST["app/scripts/templates/"+this.tmpl_dir+"/ux.uxv2."+this.orientation+"."+this.screen+".ejs"]},tbody:function(a){return JST["app/scripts/templates/"+this.tmpl_dir+"/ux.uxv2."+this.orientation+"."+this.screen+".body.ejs"]},beforeRender:function(a){if("p_kyc"===this.screen||"p_kyc_1"===this.screen){var b=Plugin.app.configMgr.getConfigVal("needpanabove");b&&(this.state.need_pan=this.state.feeStruct.amount_to_pay>=Number(b))}if(this.flow.transitions[this.screen].hasOwnProperty("amounts")&&(this.state.amounts=this.flow.transitions[this.screen].amounts),Plugin.app.configMgr.getConfigVal("amounts"+this.state.currency.name)?this.state.amounts=Plugin.app.configMgr.getConfigVal("amounts"+this.state.currency.name):"INR"===this.state.currency.name&&Plugin.app.configMgr.getConfigVal("amounts")?this.state.amounts=Plugin.app.configMgr.getConfigVal("amounts"):Plugin.app.configMgr.currencyConfig.hasOwnProperty(this.state.currency.name)?this.state.amounts=Plugin.app.configMgr.currencyConfig[this.state.currency.name].amounts:this.state.amounts=[],this.flow.transitions[this.screen].hasOwnProperty("amount")&&(this.state.amount=this.flow.transitions[this.screen].amount),Plugin.app.configMgr.getConfigVal("amount")&&(this.state.amount=Plugin.app.configMgr.getConfigVal("amount")),this.flow.transitions[this.screen].hasOwnProperty("cta1")&&(this.state.cta1=this.flow.transitions[this.screen].cta1),Plugin.app.configMgr.getConfigVal("cta1")&&(this.state.cta1=Plugin.app.configMgr.getConfigVal("cta1")),this.flow.transitions[this.screen].hasOwnProperty("cta")&&(this.state.cta=this.flow.transitions[this.screen].cta),Plugin.app.configMgr.getConfigVal("cta")&&(this.state.cta=Plugin.app.configMgr.getConfigVal("cta")),"p_pollq"===this.screen&&(this.state.poll_question=this.flow.transitions.p_pollq.question,this.state.poll_answers=this.flow.transitions.p_pollq.answers,this.state.polla))return void this.showPollResults();this.state.has_next=!!this.flow.transitions[this.screen].c_next,this.state.has_back=!!this.flow.transitions[this.screen].c_back,this.state.ui={},this.state.ui.hidepgmsg=!0,this.state.ui.imgstyle="max-height: 140px;",this.state.ui.fgcolor=Plugin.app.configMgr.getConfigVal("fgColor")||"white",this.state.ui.bgcolor=Plugin.app.configMgr.getConfigVal("bgColor")||Plugin.app.configMgr.getConfigVal("rpColor"),this.state.ui.fgcontrols=Plugin.app.configMgr.getConfigVal("fgcontrols"),this.state.ui.fillLogo=Plugin.app.configMgr.getConfigVal("fillLogo"),this.state.ui.logoHolderMaxWidth=Plugin.app.configMgr.getConfigVal("logoHolderMaxWidth");var c=function(a,b){if(b.hasOwnProperty("ui"))for(var c in b.ui)b.ui.hasOwnProperty(c)&&(a.ui[c]=b.ui[c])};c(this.state,Plugin.app.configMgr.scfg),c(this.state,this.flow.transitions[this.screen]),"landscape"===this.orientation&&Plugin.app.configMgr.getConfigVal("landscape_logowth")&&(this.state.ui.logowth=Plugin.app.configMgr.getConfigVal("landscape_logowth")),["portrait_small","portrait_tall"].indexOf(this.orientation)>-1&&Plugin.app.configMgr.getConfigVal("portrait_logowth")&&(this.state.ui.logowth=Plugin.app.configMgr.getConfigVal("portrait_logowth"))},afterRender:function(a){setTimeout(Plugin.app.requestPositioning.bind(Plugin.app),200);var b=function(a,b,c){return function(){for(var d=document.getElementsByClassName(a),e=0;e<d.length;e++)d[e].style[b]=c}},c=function(a){return function(){var b=document.getElementsByClassName(a);if(2===b.length){var c=b[0].getClientRects()[0].height,d=b[1].getClientRects()[0].height;c>d&&(b[1].style.height=String(c)+"px"),d>c&&(b[0].style.height=String(d)+"px")}}};if(setTimeout(b("fade-in","opacity","1"),0),setTimeout(b("shrinking-border","border-radius","3px"),0),setTimeout(c("grow-height"),10),setTimeout(c("grow-height"),100),setTimeout(c("grow-height"),500),"p_gotopg"===this.screen&&this.initPayment(a),"p_cta_2"===this.screen){var d=this,e=function(){var a=document.getElementById("amount-input");if(a&&a.value){var b=Number(a.value);b>0?b>10&&(d.state.amount=b,document.getElementById("button-amount").innerHTML="₹"+String(b)):a.value=""}};this.checkInputTimer=setInterval(e,200)}else this.checkInputTimer&&(clearInterval(this.checkInputTimer),this.checkInputTimer=null);if("p_polla"===this.screen)for(var f in this.state.poll_result_bar_width)setTimeout(b("growing-bar-"+f,"width",String(this.state.poll_result_bar_width[f])+"%"),0)},render:function(a){this.beforeRender(a),this.el.innerHTML=this.t(this.screen).apply(this.state);var b=document.getElementById("orcsnet-plugin-body");b&&(this.bodyElement=b,this.bodyElement.innerHTML=this.tbody(this.screen).apply(this.state)),this.afterRender(a)},renderBody:function(a){return this.bodyElement?(this.beforeRender(a),this.bodyElement.innerHTML=this.tbody(this.screen).apply(this.state),void this.afterRender(a)):void this.render(a)},clickHandler:function(a){var b=a.delegateTarget||a.currentTarget||a.target,c=b.getAttribute("data-ctrl");switch(c){case"transition":var d=b.getAttribute("data-to");"c_back"===d&&"p_amtselection"===this.screen&&(this.state.amount=null),"c_back"===d&&"p_methodselection"===this.screen&&(this.state.retrying=!1),"c_back"===d&&"p_methodselection_1"===this.screen&&(this.state.retrying=!1),d&&(this.screen=this.flow.transitions[this.screen][d],this.setRotStart(),this.render());break;case"rot":this.state.rot++,this.render();break;case"amt.left":this.state.rot>0&&(this.state.rot--,this.render());break;case"amt.right":this.state.rot<2&&(this.state.rot++,this.render());break;case"select-ptype":this.state.ptype=b.getAttribute("data-ptype"),this.setFees(),this.screen=this.flow.transitions[this.screen].c_next,this.render();break;case"select-ptype-and-amt-0":this.state.ptype=b.getAttribute("data-ptype"),this.state.amount=Number(b.getAttribute("data-amt")),this.setFees(),this.screen=this.flow.transitions[this.screen].c_sub_next,this.render();break;case"select-ptype-and-amt":this.state.ptype=b.getAttribute("data-ptype");var e=Number(document.getElementById("amount-input").value);e=Math.round(e,0);var f=Number(Plugin.app.configMgr.getConfigVal("uxv2.lowerlimit"))||100,g=Number(Plugin.app.configMgr.getConfigVal("uxv2.upperlimit"))||1e4;if(f>e||e>g)return document.getElementById("amount-input").value="",void(document.getElementById("amount-input").placeholder=String(f)+" to "+String(g));this.state.amount=e,this.setFees(),this.screen=this.flow.transitions[this.screen].c_next,this.render();break;case"select-ptype-and-name":if("p_followup201904"===this.screen){this.state.name_is_mandatory=!1;var h=document.getElementById("name-input");if(h){if(h.value=h.value||"",h.value&&(h.value=h.value.trim()),!h.value)return this.state.name_is_mandatory=!0,this.state.supporterName="",void this.render();this.state.supporterName=h.value}}this.state.ptype=b.getAttribute("data-ptype"),this.setFees(),this.state.method="cards-auto-selected",this.screen=this.flow.transitions[this.screen].c_next,this.render();break;case"select-amt":this.state.amount=Number(b.getAttribute("data-amt")),this.setFees(),b.getAttribute("data-method")&&(this.state.method=b.getAttribute("data-method")),this.screen=this.flow.transitions[this.screen].c_next,this.render();break;case"select-customamt-vsub":this.state.amount=null,this.state.customAmount=!0,(this.state.subscriptions||this.state.vsubscriptions)&&(this.state.ptype=null),this.renderBody();var h=document.getElementById("custom-amt-vsub");h&&h.focus();break;case"select-amt-vsub":this.state.amount=Number(b.getAttribute("data-amt")),this.state.customAmount=!1,this.setFees(),this.renderBody();break;case"select-method-vsub":this.state.method=b.getAttribute("data-method"),this.render();break;case"select-method-and-pay-vsub":if(this.state.method=b.getAttribute("data-method"),this.state.ptype&&this.state.amount){var i=this.flow.transitions[this.screen].c_next;this.screen=i[this.state[i.condition_var]],this.render()}break;case"select-method-and-pay-2-vsub":if(this.state.method=b.getAttribute("data-method"),this.state.customAmount){var h=document.getElementById("custom-amt-vsub");if(h&&h.value){var j=Number(h.value),k=Plugin.app.configMgr.currencyConfig[this.state.currency.name].range[0],l=Plugin.app.configMgr.currencyConfig[this.state.currency.name].range[1];j>=k&&l>j?(this.state.amount=j,this.state.customAmount=!0):((this.state.subscriptions||this.state.vsubscriptions)&&(this.state.ptype=null),this.state.amount=null,this.state.customAmount=!1,h.value="")}this.setFees()}this.state.ptype&&this.state.amount&&(this.setFees(),this.screen=this.flow.transitions[this.screen].c_next,this.render());break;case"select-frequency-vsub":this.state.ptype=b.getAttribute("data-frequency"),this.setFees();var h=document.getElementById("custom-amt-vsub");if(h&&h.value){var j=Number(h.value),k=Plugin.app.configMgr.currencyConfig[this.state.currency.name].range[0],l=Plugin.app.configMgr.currencyConfig[this.state.currency.name].range[1];j>=k&&l>j?(this.state.amount=j,this.state.customAmount=!0):(this.state.ptype=null,this.state.amount=null,this.state.customAmount=!1),this.setFees()}else this.state.customAmount=!1;this.renderBody();break;case"select-support-plan":this.state.supportPlan=b.getAttribute("data-support-plan"),this.render();break;case"select-custom-amt":var h=document.getElementById("input_custom_amt");if(h){var j=Number(h.value.trim());j>10&&1e4>j&&(this.state.amount=j,this.setFees(),this.screen=this.flow.transitions[this.screen].c_next),this.state.method=b.getAttribute("data-method"),this.render()}break;case"select-method":this.state.method=b.getAttribute("data-method"),this.screen=this.flow.transitions[this.screen].c_next,this.render(a);break;case"try-razorpay":this.payWithRazorpay_Spot(a);break;case"verify-pan":var h=document.getElementById("input_pan"),m=h.value.trim();m?this.isValidPan(m)?(this.userpan=m.toUpperCase(),this.screen=this.flow.transitions[this.screen].c_next,this.render()):(h.value="",h.placeholder="Invalid PAN, try again?"):(h.value="",h.placeholder="PAN is required");break;case"select-polla":this.state.polla=b.getAttribute("data-polla"),Plugin.app.submitPollResponse(this.pollName,this.state.polla,this.showPollResults.bind(this));break;case"toggle-monthly-vsub":"instant"===this.state.ptype?this.state.ptype="vsub.subscription.monthly":this.state.ptype="instant",this.render();break;case"set-email-vsub":var n=document.getElementById("input_email");if(n){var o=n.value.trim();o&&this.isValidEmail(o)?(this.state.vsubemail=o,Plugin.app.getSavedVSub(o,function(a){a?(this.state.savedVSub=a,Plugin.log("found vsub:"),Plugin.log(a),a.email=o,this.state.savedVSub.id=a.vsub_id,this.renderBody()):(Plugin.log("no existing vsub"),this.state.need_email=!1,this.renderBody())}.bind(this))):(this.state.vsubemail="",this.state.need_email=!0,this.renderBody())}break;case"pay-with-vsub":var n=document.getElementById("input_email");if(n){var o=n.value.trim();o&&this.isValidEmail(o)?(this.state.vsubemail=o,Plugin.app.getSavedVSub(o,function(a){a?(this.state.savedVSub=a,Plugin.log("found vsub:"),Plugin.log(a),a.email=o,this.state.savedVSub.id=a.vsub_id,this.renderBody()):(Plugin.log("no existing vsub"),this.state.need_email=!1,this.screen=this.flow.transitions[this.screen].c_next,this.renderBody())}.bind(this))):(this.state.vsubemail="",this.state.need_email=!0,this.renderBody())}break;case"set-language":var p=b.getAttribute("data-language");Plugin.app.configMgr.language=p||"english",this.state.strings=this.getStringPack(),this.renderBody();break;case"change-currency":this.state.selecting_currency=!0,this.renderBody();break;case"select-currency":var q=b.getAttribute("data-currency");this.state.currency=Plugin.app.configMgr.currencyConfig[q],"INR"!==q&&(this.state.ptype="instant"),this.state.amount=null,this.state.customAmount=!1,this.state.selecting_currency=!1,this.renderBody();break;case"tnm-new-support-plan":var r=document.getElementById("input_name"),n=document.getElementById("input_email"),s=document.getElementById("input_location");if(r&&n&&s){var t=r.value.trim(),o=n.value.trim(),u=s.value.trim();if(this.state.need_email=!0,this.state.need_name=!0,o&&this.isValidEmail(o)?(this.state.need_email=!1,this.state.email=o,this.state.supporterEmail=o):(this.state.email="",this.state.supporterEmail=""),t?(this.state.need_name=!1,this.state.supporterName=t,this.state.firstName=t):(this.state.supporterName="",this.state.firstName=""),this.state.need_email||this.state.need_name)this.renderBody();else{this.screen=this.flow.transitions[this.screen].c_next,this.renderBody(),this.state.location=u,this.state.amount=Plugin.app.configMgr.getConfigVal("amount"),this.setFees();var v=b.getAttribute("data-support-type");"subscription"===v?(this.state.method="cards-auto-selected",this.state.ptype="yearly"):"vsubscription"===v&&(this.state.method="upi",this.state.ptype="vsub.subscription.yearly",this.state.vsubemail=o),this.initPayment()}}}},setFees:function(){this.state.ptype&&this.state.amount&&(this.state.feeStruct={button_amount:this.state.amount,fees:0,amount_to_pay:this.state.amount,base_amount:this.state.amount,base_amount_gst:0})},isValidPan:function(a){if(!a)return!1;if(a=a.toUpperCase().replace(/ /g,""),10!==a.length)return!1;var b=a.substring(0,3),c=a.substring(3,4),d=a.substring(4,5),e=a.substring(5,9),f=a.substring(9,10),g=b&&b.match(/[A-Z]+/);if(!g)return!1;var g=c&&c.match(/[CPHFATBLJG]/);if(!g)return!1;var g=d&&d.match(/[A-Z]/);if(!g)return!1;var g=e&&e.match(/[0-9]+/);if(!g)return!1;var g=f&&f.match(/[A-Z]/);return g?!0:!1},isValidEmail:function(a){return a?!!a.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/):!1},initPayment:function(a){switch(this.state.method){case"paytm":this.payWithPayTMSpot(a);break;case"ccavenue":this.payWithCCAvenue(a);break;case"other":this.payWithRazorpay_Spot(a);break;case"upi":case"cnb":case"cnbupi":this.payWithRazorpay_Spot(a);break;case"cards-auto-selected":this.payWithRazorpay_Subscription(a)}},payWithPayTMSpot:function(a){return void this.cancelPayment()},payWithCCAvenue:function(a){var b=this,c={button_amount:this.state.feeStruct.button_amount,amount_to_pay:this.state.feeStruct.amount_to_pay,payment_type:this.state.ptype,callbacks:{success:function(){Plugin.log("ccavenue-success"),b.afterPayment("")},ccavenuefail:function(a){Plugin.log(a),b.cancelPayment()}}};this.state.supporterName&&(c.supporterName=this.state.supporterName),this.state.vsubemail&&(c.vsubemail=this.state.vsubemail),Plugin.app.payments.payWithCCAvenue(c)},payWithRazorpay_Spot:function(a){var b={payment_type:this.state.ptype,button_amount:this.state.feeStruct.button_amount,amount_to_pay:this.state.feeStruct.amount_to_pay,currency:this.state.currency&&this.state.currency.name||"INR",callbacks:{ondismiss:this.cancelPayment.bind(this),onsuccess:this.afterPayment.bind(this)}};this.state.supporterName&&(b.supporterName=this.state.supporterName),this.state.vsubemail&&(b.vsubemail=this.state.vsubemail),Plugin.app.payments.payWithRazorpay_Spot(b)},payWithRazorpay_Subscription:function(a){var b={plan_amount:this.state.feeStruct.button_amount,subscription_type:this.state.ptype,callbacks:{ondismiss:this.cancelPayment.bind(this),onsuccess:this.afterPayment.bind(this),onerror:this.cancelPayment.bind(this)}};this.state.supporterName&&(b.supporterName=this.state.supporterName),this.state.supporterEmail&&(b.supporterEmail=this.state.supporterEmail),this.state.email&&(b.email=this.state.email),this.state.location&&(b.location=this.state.location),Plugin.app.payments.payWithRazorpay_SubMerchantAccountSubscription(b)},cancelPayment:function(){this.screen=this.flow.transitions[this.screen].c_back,this.state.retrying=!0,this.render()},afterPayment:function(a,b,c){this.screen=b||this.flow.endscreen||this.flow.transitions[this.screen].c_next,this.state.txnid=a,this.state.sub_id=c,this.state.ownerName=Plugin.app.configMgr.getConfigVal("ownerName"),"the-wire"===Plugin.app.parsedParams.ownerid?this.state.gstMessage="":this.state.gstMessage="(GST @ 18%)";var d=Plugin.app.configMgr.getConfigVal("uxv2.externalthankyou");d&&(this.state.thankYouExt=d);var e=Plugin.app.configMgr.getConfigVal("uxv2.ytplaylists");if(e){var f=this.RAND_INT(e.length);this.state.playListImgUrl=e[f].playListImgUrl,this.state.playListTitle=e[f].playListTitle,this.state.playListUrl=e[f].playListUrl}this.render()},showPollResults:function(){console.log("showPollResults");var a=this;Plugin.app.getPollResults(this.pollName,function(b){a.state.poll_result=b;var c=0,d=0;for(var e in b){var f=Number(b[e]);c+=f,f>d&&(d=f)}if(0===c)a.state.poll_no_results=!0;else{a.state.poll_result_pctg={},a.state.poll_result_bar_width={};for(var e in b)f=Number(b[e]),a.state.poll_result_pctg[e]=Math.round(100*f/c),a.state.poll_result_bar_width[e]=Math.round(100*f/d)}a.screen="p_polla",a.render()})}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.Component=Backbone.NativeView.extend({initialize:function(a){this.cname=a.config.cname,this.parent=a.parent,this.orientation_override=a.config.orientation_override,this.ux=a.config.ux||{},this.data=a.config.data||{},this.children={};for(var b in a.config.children)this.children[b]=new Plugin.Views.Component({parent:this,config:a.config.children[b]});this.childHtml={}},makeTmplLoc:function(){var a="app/scripts/templates/Uxv3/";return this.orientation_override&&(a+=this.getOrientation()+"."),a+=this.cname,a+=".ejs"},getOrientation:function(){return this.parent.getOrientation()},getData:function(){var a={},b=this.parent.getData();for(var c in b)a[c]=b[c];for(var d in this.data)a[d]=this.data[d];return a},getUx:function(){var a={},b=this.parent.getUx();for(var c in b)a[c]=b[c];for(var d in this.ux)a[d]=this.ux[d];return a},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},html:function(){for(var a in this.children)this.childHtml[a]=this.children[a].html();return JST[this.makeTmplLoc()].apply({ux:this.getUx(),data:this.getData(),childHtml:this.childHtml})}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.Uxv3=Backbone.NativeView.extend({cfg:function(a){return Plugin.app.configMgr.getConfigVal(a)},initialize:function(){var a={start:"screen_1",screen_1:{orientation_override:!0,cname:"screen.screen_1",ux:{},data:{nbuttons:3},children:{logo:{orientation_override:!0,cname:"comp.logo",data:{logourl:"https://assets.orcsnet.com/img/orc-2.png"}},cta:{orientation_override:!0,cname:"comp.cta",ux:{ctafontsize:"24px"},data:{cta:"support us"}},hr:{cname:"comp.hr"},"button-0":{cname:"ctrl.select-amt",data:{amount:100,next:"screen_2"}},"button-1":{cname:"ctrl.select-amt",data:{amount:200,next:"screen_2"}},"button-2":{cname:"ctrl.select-amt",data:{amount:500,next:"screen_2"}},legal:{orientation_override:!0,cname:"comp.legal",data:{tos_url:"https://orcsnet.com/#/terms-of-service",pp_url:"https://orcsnet.com/#/privacy-policy"}}}},screen_2:{orientation_override:!0,cname:"screen.screen_2",ux:{},data:{prompt:"How would you like to proceed?"},children:{"button-0":{cname:"ctrl.select-method",data:{method:"cnb",methodName:"Cards & Net-Banking"}},"button-1":{cname:"ctrl.select-method",data:{method:"upi",methodName:"UPI"}},"button-2":{cname:"ctrl.select-method",data:{method:"paytm",methodName:"PayTM"}},"button-3":{cname:"ctrl.select-method",data:{method:"other",methodName:"Other Wallets"}}}}};this.flow=a,this.setOrientation(),this.state={screen:a.start,history:[]},this.data={}},events:{"click .c_ctrl":"clickHandler"},setOrientation:function(){this.orientation="landscape";var a=window.innerWidth<450;"samachara"===Plugin.app.parsedParams.ownerid&&(a=window.innerWidth<800),a&&(this.orientation="portrait_small",this.cfg("uxv2.orientation-on-mobile")&&(this.orientation=this.cfg("uxv2.orientation-on-mobile"))),this.cfg("uxv2.orientation")&&(this.orientation=this.cfg("uxv2.orientation")),"portrait_tall"===Plugin.app.parsedParams.orientation&&(this.orientation="portrait_tall"),"portrait_small"===Plugin.app.parsedParams.orientation&&(this.orientation="portrait_small")},getOrientation:function(){return this.orientation},getUx:function(){return{fgcolor:this.cfg("fgcolor")||"white",bgcolor:this.cfg("bgcolor")||"#06579e"}},getData:function(){var a={},b=this.flow[this.state.screen].data;for(var c in b)a[c]=b[c];for(var d in this.data)a[d]=this.data[d];return a},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},render:function(){this.root=new Plugin.Views.Component({parent:this,config:this.flow[this.state.screen]}),this.el.innerHTML=this.root.html()},clickHandler:function(a){var b=a.delegateTarget||a.currentTarget||a.target,c=b.getAttribute("data-ctrl");switch(c){case"select-amt":this.data.chosen_amount=Number(b.getAttribute("data-amt")),this.state.history.push(this.state.screen),this.state.screen=b.getAttribute("data-next"),this.render();break;case"select-method":this.data.chosen_method=b.getAttribute("data-method"),this.state.history.push(this.state.screen),this.state.screen=b.getAttribute("data-next"),this.render();break;case"go-back":this.state.screen=this.state.history.pop(),this.render()}}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.LookupSubscription=Backbone.NativeView.extend({initialize:function(){this.ux={},this.subscription={},this.pubInfo={}},startup:function(){this.lookupSubscription()},lookupSubscription:function(){var a=this,b=new AWS.Lambda({region:"ap-south-1"}),c={pubname:Plugin.app.parsedParams.ownerid,action:"lookup"};this.subid&&(c.subId=this.subid),b.invoke({FunctionName:"LookupSubscription",Payload:JSON.stringify(c)
},function(b,c){if(b)console.log(b);else{var d=JSON.parse(c.Payload);if(a.ux.bgColor=d.bgColor,a.ux.logo=d.logo,a.ux.name=d.name,!a.subid)return void a.renderLookup();d.error?(a.error=d.error,a.render()):(console.log(d),a.subscription.status=d.status,a.subscription.period=d.period,a.subscription.amount_inr=d.amount_inr,a.subscription.created_at=d.created_at,a.pubInfo.name=d.name,a.pubInfo.email=d.publisher_email,a.ux.stage="found-subscription","cancelled"===a.subscription.status?(a.subscription.ended_at=d.ended_at,a.subscription.paid_count=d.paid_count):"active"===a.subscription.status?(a.subscription.subscriber_email=d.subscriber_email,a.subscription.next_charge_date=d.next_charge_date,a.subscription.total_spend_till_date=d.total_spend_till_date):"created"===a.subscription.status?a.subscription.short_url=d.short_url:"pending"===a.subscription.status&&(a.subscription.subscriber_email=d.subscriber_email,a.subscription.next_charge_date=d.next_charge_date,a.subscription.total_spend_till_date=d.total_spend_till_date),a.render())}})},events:{"click #button_subid":"getSubId","click .stop-subscription":"stopSubscription"},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},renderLookup:function(){this.el.innerHTML=JST["app/scripts/templates/Subscriptions/GetSubId.ejs"].apply({ux:this.ux,pubInfo:this.pubInfo})},getSubId:function(a){var b=document.getElementById("input_subid");if(b&&b.value){var c=b.value.trim();console.log(c),c.length>4&&"sub_"===c.substr(0,4)&&(this.subid=c,this.lookupSubscription())}},render:function(){this.el.innerHTML=JST["app/scripts/templates/Subscriptions/LookupSubscription.ejs"].apply({ux:this.ux,subid:this.subid,pubInfo:this.pubInfo,subscription:this.subscription,error:this.error||null})},stopSubscription:function(a){console.log("[LookupSubscription] stopSubscription"),this.ux.stage="please-wait",this.render();var b=this,c=new AWS.Lambda({region:"ap-south-1"});c.invoke({FunctionName:"LookupSubscription",Payload:JSON.stringify({pubname:Plugin.app.parsedParams.ownerid,subId:this.subid,action:"send-cancellation-email"})},function(a,c){a?(console.log(a),b.ux.stage="something-went-wrong"):b.ux.stage="cancellation-email-sent",b.render()})}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.CancelSubscription=Backbone.NativeView.extend({initialize:function(){this.ux={stage:"cancelling"},this.pubInfo={},this.render()},startup:function(){if(console.log(this.subid),console.log(this.token),!this.token)return this.ux.stage="invalid-cancellation-link",void this.render();var a=this,b=new AWS.Lambda({region:"ap-south-1"});b.invoke({FunctionName:"LookupSubscription",Payload:JSON.stringify({pubname:Plugin.app.parsedParams.ownerid,subId:this.subid,action:"cancel-subscription",token:this.token})},function(b,c){if(b)console.log(b),a.ux.stage="invalid-cancellation-link";else{a.ux.stage="subscription-cancelled";var d=JSON.parse(c.Payload);console.log(d),a.ux.bgColor=d.bgColor,a.ux.logo=d.logo,a.ux.name=d.name,a.pubInfo.email=d.publisher_email,d.error&&(a.ux.stage="invalid-cancellation-link")}a.render()})},events:{},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},render:function(){this.el.innerHTML=JST["app/scripts/templates/Subscriptions/CancelSubscription.ejs"].apply({ux:this.ux,pubInfo:this.pubInfo,subid:this.subid})}})}();