/*! JSSO Crosswalk v0.5.3 | Anupam Singh1 | (c) Times Internet Ltd */
class JssoCrosswalk{constructor(s,e){this.channel=s,this.platform=e,this.ssoBaseUrl="https://jsso.indiatimes.com/sso/crossapp/identity/web/",this.socialappBaseUrl="https://socialappsintegrator.indiatimes.com/socialsite/crossapp/web/",this.sdkVersion="0.5.3",this.csrfToken=this.getCookie("jsso_crosswalk_csrfToken_"+this.channel),this.ssec=this.getCookie("jsso_crosswalk_ssec_"+this.channel),this.tksec=this.getCookie("jsso_crosswalk_tksec_"+this.channel),this.csut=this.getCookie("csut"),this.gdpr=this.getCookie("gdpr"),this.UNAUTHORIZED_ACCESS_RESPONSE={code:404,message:"UNAUTHORIZED_ACCESS",status:"FAILURE",data:null},this.CONNECTION_ERROR_RESPONSE={code:503,message:"CONNECTION_ERROR",status:"FAILURE",data:null},this.CONNECTION_TIMEOUT_RESPONSE={code:504,message:"CONNECTION_TIMEOUT",status:"FAILURE",data:null},this.APP_CONNECTION_TIMEOUT_RESPONSE={code:505,message:"TRUECALLER_LOGIN_FAILURE",status:"FAILURE",data:null},this.INVALID_MOBILE={code:402,message:"INVALID_MOBILE",status:"FAILURE",data:null},this.INVALID_EMAIL={code:403,message:"INVALID_EMAIL",status:"FAILURE",data:null},this.INVALID_REQUEST={code:413,message:"INVALID_REQUEST",status:"FAILURE",data:null},this.INVALID_PASSWORD={code:417,message:"INVALID_PASSWORD",status:"FAILURE",data:null};var i=this.getChannelCookies();""!=i.login&&""==i.daily&&this.getValidLoggedInUser()}asyncJssoCall(s,e,i){this.asyncCall(this.ssoBaseUrl+s,e,i)}asyncSocialappCall(s,e,i){this.asyncCall(this.socialappBaseUrl+s,e,i)}asyncCall(s,e,i){var t=new XMLHttpRequest;t.open("POST",s),t.timeout=3e4,t.withCredentials=!0,t.setRequestHeader("content-type","application/json"),t.setRequestHeader("channel",this.channel),t.setRequestHeader("platform",this.platform),t.setRequestHeader("sdkVersion",this.sdkVersion),t.setRequestHeader("IsJssoCrosswalk","true"),t.setRequestHeader("csrfToken",this.csrfToken),t.setRequestHeader("ssec",this.ssec),t.setRequestHeader("tksec",this.tksec),t.setRequestHeader("csut",this.csut),t.setRequestHeader("gdpr",this.gdpr),t.responseType="json",t.onload=function(){var s=t.response;return"string"==typeof s&&(s=JSON.parse(s)),s&&s.code?404==s.code?(this.deleteChannelCookies(),void(i&&i(s))):(t.getResponseHeader("csrfToken")&&(this.csrfToken=t.getResponseHeader("csrfToken")),t.getResponseHeader("ssec")&&(this.ssec=t.getResponseHeader("ssec")),t.getResponseHeader("tksec")&&(this.tksec=t.getResponseHeader("tksec")),t.getResponseHeader("csut")&&(this.csut=t.getResponseHeader("csut")),t.getResponseHeader("gdpr")&&(this.gdpr=t.getResponseHeader("gdpr")),i?i(s):void 0):(this.deleteChannelCookies(),void(i&&i(this.UNAUTHORIZED_ACCESS_RESPONSE)))}.bind(this),t.onerror=function(){if(i)return i(this.CONNECTION_ERROR_RESPONSE)}.bind(this),t.ontimeout=function(){if(i)return i(this.CONNECTION_TIMEOUT_RESPONSE)}.bind(this),t.send(JSON.stringify(e))}getValidLoggedInUser(s){this.asyncJssoCall("loggedInUser",{},function(e){if(200==e.code&&this.createChannelCookies(),s)return s(e)}.bind(this))}checkUserExists(s,e){this.asyncJssoCall("checkUserExists",{identifier:s},e)}registerUser(s,e,i,t,a,o,r,n,l,h,d,c){return a||o?a&&!this.isValidEmail(a)?c(this.INVALID_EMAIL):o&&!this.isValidMobile(o)?c(this.INVALID_MOBILE):this.isValidPassword(r)?void this.asyncJssoCall("registerUser",{firstName:s,lastName:e,gender:i,dob:t,email:a,mobile:o,password:r,isSendOffer:n,termsAccepted:l,shareDataAllowed:h,timespointsPolicy:d},c):c(this.INVALID_PASSWORD):c(this.INVALID_REQUEST)}registerUserRecaptcha(s,e,i,t,a,o,r,n,l,h,d,c,u){return a||o?a&&!this.isValidEmail(a)?u(this.INVALID_EMAIL):o&&!this.isValidMobile(o)?u(this.INVALID_MOBILE):this.isValidPassword(r)?void this.asyncJssoCall("registerUserRecaptcha",{firstName:s,lastName:e,gender:i,dob:t,email:a,mobile:o,password:r,isSendOffer:n,recaptcha:l,termsAccepted:h,shareDataAllowed:d,timespointsPolicy:c},u):u(this.INVALID_PASSWORD):u(this.INVALID_REQUEST)}resendMobileSignUpOtp(s,e,i){if(!this.isValidMobile(s))return i(this.INVALID_MOBILE);this.asyncJssoCall("resendSignUpOtp",{mobile:s,ssoid:e},i)}resendEmailSignUpOtp(s,e,i){if(!this.isValidEmail(s))return i(this.INVALID_EMAIL);this.asyncJssoCall("resendSignUpOtp",{email:s,ssoid:e},i)}verifyMobileSignUp(s,e,i,t){if(!this.isValidMobile(s))return t(this.INVALID_MOBILE);this.asyncJssoCall("verifySignUpOTP",{mobile:s,ssoid:e,otp:i},function(s){if(200==s.code&&this.createChannelCookies(),t)return t(s)}.bind(this))}verifyEmailSignUp(s,e,i,t){if(!this.isValidEmail(s))return t(this.INVALID_EMAIL);this.asyncJssoCall("verifySignUpOTP",{email:s,ssoid:e,otp:i},function(s){if(200==s.code&&this.createChannelCookies(),t)return t(s)}.bind(this))}verifyMobileLogin(s,e,i){if(!this.isValidMobile(s))return i(this.INVALID_MOBILE);this.asyncJssoCall("verifyLoginOtpPassword",{mobile:s,password:e},function(s){if(200==s.code&&this.createChannelCookies(),i)return i(s)}.bind(this))}verifyEmailLogin(s,e,i){if(!this.isValidEmail(s))return i(this.INVALID_EMAIL);this.asyncJssoCall("verifyLoginOtpPassword",{email:s,password:e},function(s){if(200==s.code&&this.createChannelCookies(),i)return i(s)}.bind(this))}facebookLogin(s,e,i){this.asyncSocialappCall("facebookLogin",{code:s,facebookRedirectUri:e},function(s){if(200==s.code&&this.createChannelCookies(),i)return i(s)}.bind(this))}googleplusLogin(s,e,i){this.asyncSocialappCall("googleplusLogin",{code:s,googleplusRedirectUri:e},function(s){if(200==s.code&&this.createChannelCookies(),i)return i(s)}.bind(this))}linkedinLogin(s,e,i){this.asyncSocialappCall("linkedinLogin",{code:s,linkedinRedirectUri:e},function(s){if(200==s.code&&this.createChannelCookies(),i)return i(s)}.bind(this))}getUserProfile(s){this.asyncJssoCall("getUserProfile",{},s)}getUserDetails(s){this.asyncJssoCall("getUserDetails",{},s)}getMobileLoginOtp(s,e){if(!this.isValidMobile(s))return e(this.INVALID_MOBILE);this.asyncJssoCall("getLoginOtp",{mobile:s},e)}getEmailLoginOtp(s,e){if(!this.isValidEmail(s))return e(this.INVALID_EMAIL);this.asyncJssoCall("getLoginOtp",{email:s},e)}updateUserProfile(s,e,i,t,a,o,r,n){this.asyncJssoCall("updateUserProfile",{firstName:s,lastName:e,gender:i,dob:t,city:a,termsAccepted:o,shareDataAllowed:r},n)}getMobileForgotPasswordOtp(s,e){if(!this.isValidMobile(s))return e(this.INVALID_MOBILE);this.asyncJssoCall("getForgotPasswordOtp",{mobile:s},e)}getEmailForgotPasswordOtp(s,e){if(!this.isValidEmail(s))return e(this.INVALID_EMAIL);this.asyncJssoCall("getForgotPasswordOtp",{email:s},e)}verifyMobileForgotPassword(s,e,i,t,a){return this.isValidMobile(s)?this.isValidPassword(i)?void this.asyncJssoCall("verifyForgotPassword",{mobile:s,otp:e,password:i,confirmPassword:t},a):a(this.INVALID_PASSWORD):a(this.INVALID_MOBILE)}verifyEmailForgotPassword(s,e,i,t,a){return this.isValidEmail(s)?this.isValidPassword(i)?void this.asyncJssoCall("verifyForgotPassword",{email:s,otp:e,password:i,confirmPassword:t},a):a(this.INVALID_PASSWORD):a(this.INVALID_EMAIL)}loginMobileForgotPassword(s,e,i,t,a){return this.isValidMobile(s)?this.isValidPassword(i)?void this.asyncJssoCall("loginForgotPassword",{mobile:s,otp:e,password:i,confirmPassword:t},function(s){if(200==s.code&&this.createChannelCookies(),a)return a(s)}.bind(this)):a(this.INVALID_PASSWORD):a(this.INVALID_MOBILE)}loginEmailForgotPassword(s,e,i,t,a){return this.isValidEmail(s)?this.isValidPassword(i)?void this.asyncJssoCall("loginForgotPassword",{email:s,otp:e,password:i,confirmPassword:t},function(s){if(200==s.code&&this.createChannelCookies(),a)return a(s)}.bind(this)):a(this.INVALID_PASSWORD):a(this.INVALID_EMAIL)}signOutUser(s){this.asyncJssoCall("signOutUser",{},function(e){if(this.deleteChannelCookies(),s)return s(e)}.bind(this))}updateMobile(s,e){if(!this.isValidMobile(s))return e(this.INVALID_MOBILE);this.asyncJssoCall("updateMobile",{mobile:s},e)}verifyMobile(s,e,i){if(!this.isValidMobile(s))return i(this.INVALID_MOBILE);this.asyncJssoCall("verifyMobile",{mobile:s,otp:e},i)}addAlternateEmail(s,e){if(!this.isValidEmail(s))return e(this.INVALID_EMAIL);this.asyncJssoCall("addAlternateEmail",{email:s},e)}verifyAlternateEmail(s,e,i){if(!this.isValidEmail(s))return i(this.INVALID_EMAIL);this.asyncJssoCall("verifyAlternateEmail",{email:s,otp:e},i)}linkFacebook(s,e,i){this.asyncJssoCall("linkSocial",{oauthSiteId:"facebook",oauthCode:s,redirectUri:e},i)}linkGoogleplus(s,e,i){this.asyncJssoCall("linkSocial",{oauthSiteId:"googleplus",oauthCode:s,redirectUri:e},i)}linkLinkedin(s,e,i){this.asyncJssoCall("linkSocial",{oauthSiteId:"linkedin",oauthCode:s,redirectUri:e},i)}delinkSocial(s,e){this.asyncJssoCall("delinkSocial",{oauthSiteId:s},e)}setPassword(s,e,i){if(!this.isValidPassword(s))return i(this.INVALID_PASSWORD);this.asyncJssoCall("setPassword",{newPassword:s,confirmPassword:e},i)}changePassword(s,e,i,t){if(!this.isValidPassword(e))return t(this.INVALID_PASSWORD);this.asyncJssoCall("changePassword",{oldPassword:s,newPassword:e,confirmPassword:i},t)}changePrimaryEmail(s,e){if(!this.isValidEmail(s))return e(this.INVALID_EMAIL);this.asyncJssoCall("changePrimaryEmail",{emailId:s},e)}facebookLoginAccessToken(s,e,i){this.asyncSocialappCall("facebookLogin",{accessToken:s,facebookRedirectUri:e},function(s){if(200==s.code&&this.createChannelCookies(),i)return i(s)}.bind(this))}linkFacebookAccessToken(s,e,i){this.asyncJssoCall("linkSocial",{oauthSiteId:"facebook",accessToken:s,redirectUri:e},i)}socialImageUpload(s,e){this.asyncJssoCall("socialImageUpload",{oauthSiteId:s},e)}updateProfilePic(s,e){var i=this.ssoBaseUrl+"uploadProfilePic",t=new FormData(this);t.append("datafile",s);var a=new XMLHttpRequest;a.open("POST",i),a.timeout=3e4,a.withCredentials=!0,a.setRequestHeader("channel",this.channel),a.setRequestHeader("platform",this.platform),a.setRequestHeader("sdkVersion",this.sdkVersion),a.setRequestHeader("IsJssoCrosswalk","true"),a.setRequestHeader("csrfToken",this.csrfToken),a.setRequestHeader("ssec",this.ssec),a.setRequestHeader("tksec",this.tksec),a.responseType="json",a.onload=function(){var s=a.response;return"string"==typeof s&&(s=JSON.parse(s)),s&&s.code?404==s.code?(this.deleteChannelCookies(),void(e&&e(s))):(a.getResponseHeader("csrfToken")&&(this.csrfToken=a.getResponseHeader("csrfToken")),a.getResponseHeader("ssec")&&(this.ssec=a.getResponseHeader("ssec")),a.getResponseHeader("tksec")&&(this.tksec=a.getResponseHeader("tksec")),e?e(s):void 0):(this.deleteChannelCookies(),void(e&&e(this.UNAUTHORIZED_ACCESS_RESPONSE)))}.bind(this),a.onerror=function(){if(e)return e(this.CONNECTION_ERROR_RESPONSE)}.bind(this),a.ontimeout=function(){if(e)return e(this.CONNECTION_TIMEOUT_RESPONSE)}.bind(this),a.send(t)}registerOnlyMobile(s,e,i,t,a,o,r,n){return t?t&&!this.isValidMobile(t)?n(this.INVALID_MOBILE):void this.asyncJssoCall("registerOnlyMobile",{firstName:s,lastName:e,gender:i,mobile:t,termsAccepted:a,shareDataAllowed:o,timespointsPolicy:r},n):n(this.INVALID_REQUEST)}truecallerLogin(s,e){return s?s&&!this.isValidMobile(s)?e(this.INVALID_MOBILE):void this.asyncJssoCall("truecallerLogin",{mobile:s},e):e(this.INVALID_REQUEST)}truecallerVerify(s,e){if(!s)return e(this.INVALID_REQUEST);this.asyncJssoCall("truecallerVerify",{requestId:s},function(s){if(200==s.code&&this.createChannelCookies(),e)return e(s)}.bind(this))}addAlternateEmailTrap(s,e,i,t){if(!this.isValidEmail(s))return t(this.INVALID_EMAIL);this.asyncJssoCall("addAlternateEmailIdTrap",{email:s,password:e,alterEmail:i},t)}verifyAlternateEmailTrap(s,e,i,t,a){if(!this.isValidEmail(s))return a(this.INVALID_EMAIL);this.asyncJssoCall("verifyAlternateEmailIdTrap",{email:s,password:e,alterEmail:i,otp:t},a)}addAlternateMobileTrap(s,e,i,t){if(!this.isValidEmail(s))return t(this.INVALID_EMAIL);this.asyncJssoCall("addAlternateEmailIdTrap",{email:s,password:e,alterMobile:i},t)}verifyAlternateMobileTrap(s,e,i,t,a){if(!this.isValidEmail(s))return a(this.INVALID_EMAIL);this.asyncJssoCall("verifyAlternateMobileTrap",{email:s,password:e,alterMobile:i,otp:t},a)}deleteAccount(s,e){this.asyncJssoCall("deleteUser",{password:s},e)}getChannelDetails(s,e,i){this.asyncJssoCall("channelDetails",{channel:s,ru:e},i)}gpOneTapLogin(s,e){this.asyncJssoCall("gpOneTap",{token:s},function(s){if(200==s.code&&this.createChannelCookies(),e)return e(s)}.bind(this))}subscriberLogin(s,e){this.asyncJssoCall("subscriberLogin",{token:s},function(s){if(200==s.code&&this.createChannelCookies(),e)return e(s)}.bind(this))}verifyMobileLoginGdpr(s,e,i,t,a,o){if(!this.isValidMobile(s))return o(this.INVALID_MOBILE);this.asyncJssoCall("verifyLoginOtpPasswordGdpr",{mobile:s,password:e,termsAccepted:i,shareDataAllowed:t,timespointsPolicy:a},function(s){if(200==s.code&&this.createChannelCookies(),o)return o(s)}.bind(this))}verifyEmailLoginGdpr(s,e,i,t,a,o){if(!this.isValidEmail(s))return o(this.INVALID_EMAIL);this.asyncJssoCall("verifyLoginOtpPasswordGdpr",{email:s,password:e,termsAccepted:i,shareDataAllowed:t,timespointsPolicy:a},function(s){if(200==s.code&&this.createChannelCookies(),o)return o(s)}.bind(this))}updateUserPermissions(s,e,i,t){this.asyncJssoCall("updateUserPermissions",{termsAccepted:s,shareDataAllowed:e,timespointsPolicy:i},function(s){if(200==s.code&&this.createChannelCookies(),t)return t(s)}.bind(this))}truecallerOneTapLogin(s,e){if(1!=s.valueOf()&&0!=s.valueOf())return e(this.INVALID_REQUEST);this.asyncJssoCall("truecallerOneTapLogin",{},function(i){if(200==i.code){if(window.location.href="truecallersdk://truesdk/web_verify?requestNonce="+i.data.requestId+"&partnerKey=Mfn40c8470b1f53324b99aa45ac47738ad539&partnerName="+i.data.channelName+"&lang=en&title=signIn&skipOption=skip",0==s.valueOf()&&e)return e(i);setTimeout(()=>{if(document.hasFocus()){if(e)return e(this.APP_CONNECTION_TIMEOUT_RESPONSE)}else if(e)return e(i)},800)}}.bind(this))}createChannelCookies(){var s=new Date,e=new Date(s);e.setHours(24,0,0,0),this.createCookie("jsso_crosswalk_login_"+this.channel,"true",2592e6),this.createCookie("jsso_crosswalk_daily_"+this.channel,"true",e-s),this.createCookie("jsso_crosswalk_csrfToken_"+this.channel,this.csrfToken,2592e6),this.createCookie("jsso_crosswalk_ssec_"+this.channel,this.ssec,2592e6),this.createCookie("jsso_crosswalk_tksec_"+this.channel,this.tksec,2592e6),this.createCookie("csut",this.csut,2592e6),this.createCookie("gdpr",this.gdpr,2592e6)}getChannelCookies(){var s={};return s.login=this.getCookie("jsso_crosswalk_login_"+this.channel),s.daily=this.getCookie("jsso_crosswalk_daily_"+this.channel),s}deleteChannelCookies(){this.deleteCookieByName("jsso_crosswalk_login_"+this.channel),this.deleteCookieByName("jsso_crosswalk_daily_"+this.channel),this.deleteCookieByName("jsso_crosswalk_csrfToken_"+this.channel),this.deleteCookieByName("jsso_crosswalk_ssec_"+this.channel),this.deleteCookieByName("jsso_crosswalk_tksec_"+this.channel),this.deleteCookieByName("csut"),this.deleteCookieByName("gdpr")}getCookie(s){for(var e=s+"=",i=decodeURIComponent(document.cookie).split(";"),t=0;t<i.length;t++){for(var a=i[t];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return""}deleteCookieByName(s){document.cookie=s+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/"}createCookie(s,e,i){var t=new Date,a=t.getTime()+i;t.setTime(a),document.cookie=s+"="+e+"; expires="+t.toGMTString()+"; path=/"}isValidEmail(s){return/^(([^<>()\[\]\\.,;:\s@"]+([^<>()\[\]\\,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(s).toLowerCase())}isValidMobile(s){return/^(((\+?\(91\))|0|((00|\+)?91))-?)?[6-9]\d{9}$/.test(String(s))}isValidPassword(s){return!((s=String(s)).length<6||s.length>14)&&!!(/.*[a-z]+.*/.test(s)&&/.*[!@#$%^&*()]+.*/.test(s)&&/.*[0-9]+.*/.test(s))}}