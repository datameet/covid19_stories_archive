jQuery(document).ready(function() {var ssoLoginCheck=getCookie('itg_forced_login');console.log(ssoLoginCheck);var o=Drupal.settings.itg_sso_login.settings.base_url,i=Drupal.settings.itg_sso_login.settings.uid,n=Drupal.settings.itg_sso_login.settings.check_sso_url,r=Drupal.settings.itg_sso_login.settings.user_arg,sso_url=Drupal.settings.itg_sso_login.settings.sso_url,front_url=Drupal.settings.itg_sso_login.settings.front_url,change_pass_redirection=sso_url+'/saml_login/other/'+front_url;Drupal.settings.itg_sso_login.settings.change_arg;i && ("domain_info"==n && opener && opener.location.reload(!0),"user"==r&&window.close()),jQuery("a#myhref").attr("href","javascript:void(0)");var a=Drupal.settings.itg_sso_login.settings.logoutsec;jQuery("body").on("click",".close-pass-popup",function(){jQuery(this).parent().parent().hide();jQuery.ajax({url:o+"/itguserlogout",success:function(t){jQuery("#iframe-display").html(t),jQuery("#widget-ajex-loader").show(),setTimeout(function(){window.location=change_pass_redirection;},a)}})}),jQuery("#itg-sso-reg-password-form  label[for='edit-pass-pass1']").text("New password");var _is_sso_authrequire_s=GetQueryStringParams('ssologin');if(ssoLoginCheck!=''&&ssoLoginCheck!='null'&&ssoLoginCheck!=null&&ssoLoginCheck!==undefined&&_is_sso_authrequire_s===undefined&&window.self===window.top){console.log(ssoLoginCheck);jQuery.ajax({url:Drupal.settings.itg_widget.settings.base_url+"/itg-load-my-account",type:"post",data:"",beforeSend:function(){},success:function(t){if(0!=t.length){jQuery(".user-menu").html(t);jQuery(".user-menus").html(t);}},error:function(t,s,e){console.log(t),console.log("Details: "+s+"\nError:"+e);}});}});
function getCookie(cname){var name=cname+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' '){c=c.substring(1);}if(c.indexOf(name)==0){return c.substring(name.length,c.length);}}return "";}jQuery(document).ready(function(){jQuery("body").on("click",".user-icon.sso-click",function(){var _simpleSAMLSessionID=getCookie('SimpleSAMLSessionID');var _sso_login_url=jQuery(this).attr('href');var is_campaign_ready=getCampaignFinalCokkie();if(is_campaign_ready!==undefined&&is_campaign_ready!='undefined'&&is_campaign_ready!==null&&is_campaign_ready!='null'){var utm_cam=is_campaign_ready;var temp=_sso_login_url.split('/');var url_arr=temp.pop();var base_r=temp.join('/');var decode_url=atob(url_arr);var final_url=updateQueryStringParameter(decode_url,'utm_campaign',utm_cam);_sso_login_url=base_r+'/'+btoa(final_url);}jQuery("#widget-ajex-loader").show();if(_simpleSAMLSessionID===undefined||_simpleSAMLSessionID===null||_simpleSAMLSessionID=='null'){jQuery.ajax({url:Drupal.settings.itg_widget.settings.base_url+"/akamai-user-sp?simplesamlcookie=1",type:"post",data:"",beforeSend:function(){},success:function(t){window.location=_sso_login_url;},error:function(t,s,e){console.log(t);console.log("Details: "+s+"\nError:"+e);}});}else{window.location=_sso_login_url;}});
jQuery("body").on("click","#myhref",function(){document.cookie='itg_forced_login=null;domain=.indiatoday.in;path=/';document.cookie='itg_sso_uid=null;domain=.indiatoday.in;path=/';jQuery("#widget-ajex-loader").show();var _logout_URL=Drupal.settings.itg_sso_login.settings.sso_url+"/simplesaml/saml2/idp/SingleLogoutService.php?ReturnTo="+Drupal.settings.baseUrl.baseUrl;var ifrm=document.createElement("iframe");ifrm.setAttribute("src",_logout_URL);ifrm.setAttribute("id",'sso-logout-iframe');ifrm.style.width="0px";ifrm.style.height="0px";jQuery(ifrm).appendTo("#page").on("load",function(){jQuery(ifrm).remove();internalLogout();});});var _is_sso_authrequire=GetQueryStringParams('ssologin');if(_is_sso_authrequire!==undefined&&window.self===window.top){var _auth_URL=Drupal.settings.baseUrl.baseUrl+"/akamai-user-sp";console.log(_auth_URL,'_auth_URL');var ifrm11=document.createElement("iframe");ifrm11.setAttribute("src",_auth_URL);ifrm11.style.width="0px";ifrm11.style.height="0px";ifrm11.onload=function(){setTimeout(function(){jQuery.ajax({url:Drupal.settings.itg_widget.settings.base_url+"/itg-load-my-account",type:"post",data:"",beforeSend:function(){},success:function(t){if(0!=t.length){jQuery(".user-menu").html(t);jQuery(".user-menus").html(t);}},error:function(t,s,e){console.log(t);console.log("Details: "+s+"\nError:"+e);}});},1000);};jQuery(ifrm11).appendTo("#page");}});function internalLogout(){document.cookie='itg_forced_login=null;domain=.indiatoday.in;path=/';document.cookie='itg_sso_uid=null;domain=.indiatoday.in;path=/';var d=new Date();var n=d.getTime();var _logout_URL=Drupal.settings.baseUrl.baseUrl+"/akamai-user-logout-sp?"+n;var ifrm1=document.createElement("iframe");ifrm1.setAttribute("src",_logout_URL);ifrm1.style.width="0px";ifrm1.style.height="0px";jQuery(ifrm1).appendTo("#page").on("load",function(){jQuery("#widget-ajex-loader").hide();window.location='/';});}function GetQueryStringParams(sParam) {var sPageURL=window.location.href;var sURLVariables=sPageURL.split('#');for(var i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split('=');if(sParameterName[0]==sParam){return sParameterName[1];}}}
/** utm_campaign start **/
jQuery(document).ready(function(){var is_campaign_ready=GetQueryStringKeyValue('utm_campaign');if(is_campaign_ready_fn()){var d=new Date();var timestmp=d.getTime();var utm_campaign_key='utm_campaign_'+timestmp;d.setTime(d.getTime()+(7*24*60*60*1000));var is_already=findCookieWithValue(is_campaign_ready);if(!is_already){document.cookie=utm_campaign_key+'='+is_campaign_ready+';'+"expires="+d.toUTCString()+';path=/';}}});function is_campaign_ready_fn(){var is_campaign_ready=GetQueryStringKeyValue('utm_campaign');if(is_campaign_ready!==undefined&&is_campaign_ready!='undefined'&&is_campaign_ready!=''&&is_campaign_ready!='null'&&is_campaign_ready!==null){return true;}return false;}function GetQueryStringKeyValue(field) {var href=window.location.href;var reg=new RegExp('[?&]'+field+'=([^&#]*)','i');var string=reg.exec(href);return string?string[1]:null;}function updateQueryStringParameter(uri,key,value){var re=new RegExp("([#])"+key+"=.*(#|$)","i");var separator="#";if(uri.match(re)){return uri.replace(re,'$1'+key+"="+value+'$2');}else{return uri+separator+key+"="+value;}}function findCookieWithValue(val){var pairs=document.cookie.split(';');var flag=false;for(var i=0;i<pairs.length;i++){var pair=pairs[i].split("=");if(pair[0]!=undefined&&pair[0].indexOf('utm_campaign')>=0){if(pair[1]==val){return true;}}}return flag;}function getCampaignFinalCokkie(){var pairs=document.cookie.split(';');var maximum='';var temp='';var c_val='';for(var i=0;i<pairs.length;i++){var pair=pairs[i].split("=");if(pair[0]!=undefined&&pair[0].indexOf('utm_campaign')>=0){temp=pair[0].split("_").pop();if(maximum==''||maximum>temp){maximum=temp;c_val=pair[1];}}}return c_val;}
/** utm_campaign start **/
